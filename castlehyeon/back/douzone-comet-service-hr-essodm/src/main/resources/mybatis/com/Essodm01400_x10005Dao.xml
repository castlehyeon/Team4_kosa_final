<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.douzone.comet.service.hr.essodm.dao.Essodm01400_x10005Dao">

	<select id="selectMaxReqNo" resultType="int">
		SELECT MAX(TO_NUMBER(SUBSTR(REQ_NO, -4))) AS MAX_NUMBER
		FROM
		HR_OFFAPPLY_MST_X10005
		WHERE TO_NUMBER(SUBSTR(REQ_NO, 4, 4)) =
		EXTRACT(YEAR FROM SYSDATE)
		AND TO_NUMBER(SUBSTR(REQ_NO, 8, 2)) =
		EXTRACT(MONTH FROM SYSDATE)
	</select>

	<select id="hasContainSamePeriod" parameterType="HashMap" resultType="String">
		SELECT CASE WHEN COUNT(*) = 0 THEN 'false'
		ELSE 'true'
		end
		FROM HR_OFFAPPLY_MST_X10005
		WHERE COMPANY_CD = #{P_COMPANY_CD}
		AND EMP_NO = #{P_EMP_NO}
		<![CDATA[
		AND START_DT <= #{P_END_DT}
		AND END_DT >= #{P_START_DT}
		]]>
		AND ATHZ_ST_CD != '4'
	</select>

	<select id="getUserInfo" parameterType="HashMap"
		resultType="com.douzone.comet.service.hr.essodm.models.Essodm01400_X10005_UserInfoModel">
		SELECT
		EMP_NO,
		KOR_NM,
		PSTN_CD,
		OGRP_CD,
		BIZAREA_CD,
		(SELECT
		COMET.FN_HR_UP_DEPT_NM2(COMPANY_CD, DEPT_CD , SYSDATE) FROM DUAL) AS
		ORG,
		POSI_CD
		FROM HR_EMP_MST
		WHERE COMPANY_CD = #{P_COMPANY_CD}
		AND EMP_NO
		= #{P_EMP_NO}
	</select>

	<select id="selectEssodm01400_X10005ModelList"
		parameterType="HashMap"
		resultType="com.douzone.comet.service.hr.essodm.models.Essodm01400_X10005Model">
		SELECT
		HOMX.COMPANY_CD,
		HOMX.REQ_NO,
		HOMX.REQ_DT,
		HOMX.DNLGB_CD,
		HOMX.DNL_CD,
		HOMX.START_DT,
		HOMX.END_DT,
		HOMX.BIZAREA_CD,
		HOMX.ATHZ_DOC_CD,
		HOMX.ATHZ_ST_CD,
		HOMX.REQ_EMP_NO,
		HEM2.REQ_KOR_NM,
		HOMX.REASON_DC,
		HEM.EMP_NO,
		HEM.KOR_NM,
		HEM.PSTN_CD,
		HEM.OGRP_CD,
		HEM.DEPT_CD,
		(SELECT
		COMET.FN_HR_UP_DEPT_NM2(HEM.COMPANY_CD, HEM.DEPT_CD , SYSDATE)
		FROM
		DUAL) AS ORG,
		HEM.POSI_CD
		FROM HR_OFFAPPLY_MST_X10005 HOMX
		LEFT JOIN
		HR_EMP_MST HEM
		ON HOMX.COMPANY_CD
		= HEM.COMPANY_CD AND HOMX.EMP_NO =
		HEM.EMP_NO AND HOMX.DEPT_CD =
		HEM.DEPT_CD
		LEFT JOIN
		(SELECT
		COMPANY_CD,
		DEPT_CD, EMP_NO, KOR_NM REQ_KOR_NM
		FROM
		HR_EMP_MST) HEM2
		ON
		HOMX.COMPANY_CD = HEM2.COMPANY_CD AND HOMX.REQ_EMP_NO = HEM2.EMP_NO
		AND HOMX.DEPT_CD = HEM2.DEPT_CD
		WHERE HOMX.DNLGB_CD = '400'
		AND
		HOMX.COMPANY_CD = #{P_COMPANY_CD}
		<if
			test='P_START_DT !=null and P_START_DT !="" and P_END_DT !=null and P_END_DT !=""'>
			AND START_DT BETWEEN #{P_START_DT} AND #{P_END_DT}
		</if>
		<if
			test='P_START_DT !=null and P_START_DT !="" and P_END_DT !=null and P_END_DT !=""'>
			AND END_DT BETWEEN #{P_START_DT} AND #{P_END_DT}
		</if>
	</select>

	<insert id="insertEssodm01400_X10005Model">
		INSERT INTO @{dzparam_dbname}[tableName] (
		[columnName]
		) VALUES (
		[columnValue]
		)
	</insert>

	<update parameterType="HashMap"
		id="updateEssodm01400_X10005Model">
		UPDATE HR_OFFAPPLY_MST_X10005
		<set>
			<if test='P_BIZAREA_CD != null and P_BIZAREA_CD != ""'>BIZAREA_CD = #{P_BIZAREA_CD},</if>
			<if test='P_DEPT_CD != null and P_DEPT_CD != ""'>DEPT_CD = #{P_DEPT_CD},</if>
			<if test='P_EMP_NO != null and P_EMP_NO != ""'>EMP_NO = #{P_EMP_NO},</if>
			<if test='P_PSTN_CD != null and P_PSTN_CD != ""'>PSTN_CD = #{P_PSTN_CD},</if>
			<if test='P_OGRP_CD != null and P_OGRP_CD != ""'>OGRP_CD = #{P_OGRP_CD},</if>
			<if test='P_POSI_CD != null and P_POSI_CD != ""'>POSI_CD = #{P_POSI_CD},</if>
			<if test='P_DNL_CD != null and P_DNL_CD != ""'>DNL_CD = #{P_DNL_CD},</if>
			<if test='P_REQ_EMP_NO != null and P_REQ_EMP_NO != ""'>REQ_EMP_NO = #{P_REQ_EMP_NO},</if>
			<if test='P_START_DT != null and P_START_DT != ""'>START_DT = #{P_START_DT},</if>
			<if test='P_END_DT != null and P_END_DT != ""'>END_DT = #{P_END_DT},</if>
			<if test='P_REQ_DY != null and P_REQ_DY != ""'>REQ_DY = #{P_REQ_DY},</if>
			<if test='P_REASON_DC != null and P_REASON_DC != ""'>REASON_DC = #{P_REASON_DC}</if>
		</set>
		WHERE
		COMPANY_CD = #{P_COMPANY_CD}
		AND REQ_NO = #{P_REQ_NO}
	</update>

	<delete id="deleteEssodm01400_X10005Model">
		DELETE
		FROM @{dzparam_dbname}[tableName]
		WHERE
		[columnName] = [columnValue]
	</delete>
</mapper>