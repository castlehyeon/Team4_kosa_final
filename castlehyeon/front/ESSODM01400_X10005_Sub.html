<!--##dddf75c0-c812-4950-a7de-9c5dd01fc880##-->
<!--##ESSODM01400_X10005_Sub##-->
<!--##RuwESfyzs1DgerhFqAFudzt6jQGgXnpsDd7JYtwsmYPsdzR4nMLe5JedZ5N8iZob##-->
<!--
  DEWS UI/UX IDE - Build Result - v1.5
  # PageID: ESSODM01400_X10005_Sub
  # PageTitle: 결근계 신청 상세내역
  # Server: http://localhost:8080/
-->
<!--

-->

<div id="containerpanel1" class="dews-ui-container-panel" data-dews-fit-bottom="true">
  <div id="containerpanelitem1" class="dews-container-item" data-dews-position="normal">
    <h4 id="tit1" class="dews-ui-title">기본정보</h4>
    <div id="userInfo_formpanel" class="dews-ui-form-panel" data-dews-columns="4">
      <ul>
        <li>
          <label>사번</label>
          <span>
            <input id="EMP_NO" name="EMP_NO" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>성명</label>
          <span>
            <input id="KOR_NM" name="KOR_NM" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>직급</label>
          <span>
            <input id="PSTN_CD" name="PSTN_CD" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>직군</label>
          <span>
            <input id="OGRP_CD" name="OGRP_CD" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li class="col-3">
          <label>소속</label>
          <span>
            <input id="ORG" name="ORG" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>직위</label>
          <span>
            <input id="POSI_CD" name="POSI_CD" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li style="display: none;">
          <label>라벨</label>
          <span>
            <input id="COMPANY_CD" name="COMPANY_CD" type="text" class="dews-ui-textbox basic" />
          </span>
        </li>
        <li style="display: none;">
          <label>라벨</label>
          <span>
            <input type="text" id="s_EMP_NO" name="s_EMP_NO" class="dews-ui-codepicker basic" data-dews-help-code="H_HR_EMP_MST_S" data-dews-help-title="사원 도움창" data-dews-help-custom="false" data-dews-help-size="big" data-dews-ajax="true" />
          </span>
        </li>
      </ul>
    </div>
    <div class="dews-button-group" style="text-align: right;">
      <button id="temp_save_button" class="dews-ui-button">임시 저장</button>
      <button id="req_button" class="dews-ui-button">결재 요청</button>
      <button id="req_cancel_button" class="dews-ui-button">결재요청 취소</button>
      <button id="delete_button" class="dews-ui-button">삭제</button>
      <button id="sub_close_button" class="dews-ui-button">목록</button>
    </div>
    <h4 id="tit3" class="dews-ui-title">결근계 신청 상세내역</h4>
    <div id="sub_formpanel" class="dews-ui-form-panel" data-dews-columns="3">
      <ul>
        <li class="col-3">
          <label>신청자</label>
          <span>
            <input id="REQ_EMP_NO" name="REQ_EMP_NO" type="text" class="dews-ui-textbox" readonly="readonly" style="width: 100px;" />
            <input id="REQ_KOR_NM" name="REQ_KOR_NM" type="text" class="dews-ui-textbox" readonly="readonly" style="width: 100px;" />
            <button id="CHANGE_REQ_USERT" class="dews-ui-button">신청자변경</button>
          </span>
        </li>
        <li class="col-3">
          <label>근태종류</label>
          <span>
            <select id="DNL_CD" name="DNL_CD" class="dews-ui-dropdownlist required" data-dews-value-field="HR_CD" data-dews-text-field="HR_CD_NM" data-dews-show-tooltip="true" style="width: 204px;" data-dews-show-value-tooltip="true" data-dews-use-numkey="false"></select>
          </span>
        </li>
        <li>
          <label>시작일</label>
          <span>
            <input type="text" id="START_DT" name="START_DT" class="dews-ui-datepicker required" />
          </span>
        </li>
        <li class="col-2">
          <label>종료일</label>
          <span>
            <input type="text" id="END_DT" name="END_DT" class="dews-ui-datepicker required" style="width: 175px;" />
          </span>
        </li>
        <li class="col-3">
          <label>사유</label>
          <span>
            <input id="REASON_DC" name="REASON_DC" type="text" class="dews-ui-textbox required" style="width: 500px;" />
          </span>
        </li>
        <li class="col-3">
          <label>결재상태</label>
          <span>
            <input id="ATHZ_ST_NM" name="ATHZ_ST_NM" type="text" class="dews-ui-textbox basic" readonly="readonly" style="width: 170px;" />
          </span>
        </li>
        <li>
          <label>신청일</label>
          <span>
            <input type="text" id="REQ_DT" name="REQ_DT" class="dews-ui-datepicker basic" readonly="readonly" />
          </span>
        </li>
        <li style="display: none;">
          <label>라벨</label>
          <span>
            <input id="ATHZ_ST_CD" name="ATHZ_ST_CD" type="text" class="dews-ui-textbox basic" />
          </span>
        </li>
      </ul>
    </div>
    <div id="main_grid" class="dews-ui-grid"></div>
  </div>
</div>

<style>
    
</style>



<script>
  dews.ready(function () {
    var self = this;
    self.version = self.version || {};
    self.version.view='1.0';


    /*b86609c9-3017-4aef-896e-65022e1080a4*/ //# sourceURL=ESSODM01400_x10005_Sub.js
    self.COMPANY_CD.text('EWP');
    
    
    
    self.sub_userInfo_ds = dews.ui.dataSource('sub_userInfo_ds', {
      grid: true,
      transport: {
        read: {
          url: dews.url.getApiUrl('HR', 'HREssodm01400_X10005Service', 'getUserInfo')
        }
      },
      schema: {
        model: {
          fields: [
            { field: 'EMP_NO', editable: false, dataType: 'string' }, 
            { field: 'KOR_NM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'OGRP_CD', editable: false, dataType: 'string' }, 
            { field: 'ORG', editable: false, dataType: 'string' }, 
            { field: 'POSI_CD', editable: false, dataType: 'string' }
          ]
    
        }
      }
    });
    self.main_ds = dews.ui.dataSource('main_ds', {
      grid: true,
      transport: {
        read: {
          url: dews.url.getApiUrl('HR', 'HREssodm01400_X10005Service', 'list_HR_OFFAPPLY_MST_X10005MST'),
          data: function () {
            return {
              start_dt: self.START_DT.value(),
              end_dt: self.END_DT.value(),
              company_cd: self.COMPANY_CD.text()
            };
          }
        }
      },
      schema: {
        model: {
          fields: [
            { field: 'COMPANY_CD', editable: false, dataType: 'string' }, 
            { field: 'REQ_NO', editable: false, dataType: 'string' }, 
            { field: 'REQ_DT', editable: false, dataType: 'string' }, 
            { field: 'DNLGB_CD', editable: false, dataType: 'string' }, 
            { field: 'DNL_CD', editable: false, dataType: 'string' }, 
            { field: 'START_DT', editable: false, dataType: 'string' }, 
            { field: 'END_DT', editable: false, dataType: 'string' }, 
            { field: 'ATHZ_DOC_CD', editable: false, dataType: 'string' }, 
            { field: 'ATHZ_ST_CD', editable: false, dataType: 'string' }, 
            { field: 'EMP_NO', editable: false, dataType: 'string' }, 
            { field: 'KOR_NM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'OGRP_CD', editable: false, dataType: 'string' }, 
            { field: 'DEPT_CD', editable: false, dataType: 'string' }, 
            { field: 'ORG', editable: false, dataType: 'string' }, 
            { field: 'POSI_CD', editable: false, dataType: 'string' }, 
            { field: 'REQ_EMP_NO', editable: false, dataType: 'string' }, 
            { field: 'REQ_KOR_NM', editable: false, dataType: 'string' }, 
            { field: 'REASON_DC', editable: false, dataType: 'string' }, 
            { field: 'REQ_DY', editable: false, dataType: 'number' }
          ]
    
        }
      }
    });
    self.dnl_ds = dews.ui.dataSource('dnl_ds', {
      schema: {
        model: {
          fields: [
            { field: 'HR_CD', editable: false, type: 'string' }, 
            { field: 'HR_CD_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{ HR_CD: "5100", HR_CD_NM: "유계결근[10일 이내]"},
    { HR_CD: "5101", HR_CD_NM: "유계결근[10일 초과]"},
    { HR_CD: "5102", HR_CD_NM: "유계결근[30일 초과]"}]
    });
    self.athz_st_ds = dews.ui.dataSource('athz_st_ds', {
      schema: {
        model: {
          fields: [
            { field: 'DNL_CD', editable: false, type: 'string' }, 
            { field: 'DNL_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{ DNL_CD: "1", DNL_NM: "임시저장"},
    { DNL_CD: "2", DNL_NM: "결재대기"},
    { DNL_CD: "3", DNL_NM: "반려"},
    { DNL_CD: "4", DNL_NM: "결재완료"}]
    });
    
    
    dews.ui.mainbuttons.localize.disable(true);
    self.s_EMP_NO.on('codedialog', /*bac2ec72-9198-4777-905f-fcea45bac730*/ function (e) {
        e.callback = function (s) {
            self.REQ_EMP_NO.text(s.EMP_NO);
            self.REQ_KOR_NM.text(s.KOR_NM);
            self.main_grid.setCellValue(self.main_grid.select(), 'REQ_EMP_NO', s.EMP_NO);
            self.main_grid.setCellValue(self.main_grid.select(), 'REQ_KOR_NM', s.KOR_NM);
            GetUserInfo(s.EMP_NO, s.COMPANY_CD);
    
        }
    });
    self.s_EMP_NO.setHelpParams(function () {
      return {
        company_cd: self.COMPANY_CD.text()
      };
    });
    self.$sub_close_button.on('click', /*64036093-15ee-4515-9241-24b3b54e6681*/ function (e) {
        //   if (self.absData_ds.getDirtyDataCount() > 0) {
        //     dews.confirm('저장되지 않은 데이터가 있습니다.\n그래도 이동 하시겠습니까?', "question").yes(function () {
        //       dews.ui.page.close();
        //     }).no(function () {
        //     });
        //   } else {
        dews.ui.page.close();
        //   }
    
    });
    self.$REQ_EMP_NO.on('change', /*1f1fac4a-039e-4381-8e09-422d31b52d2d*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
    });
    self.$REQ_KOR_NM.on('change', /*7d0bb8eb-1fce-45ec-a9a2-7857091a706a*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
    });
    self.$CHANGE_REQ_USERT.on('click', /*10c3134e-6820-4e85-a391-74ef74a1d7bd*/ function (e) {
        self.s_EMP_NO.open();
    });
    self.DNL_CD.setDataSource(self.dnl_ds);
    self.DNL_CD.on('change', /*2ddf2b3d-9672-4e5d-b425-5479d04a1352*/ function (e) {
        self.main_grid.setCellValue(self.main_grid.select(), 'DNL_CD', self.DNL_CD.value(), false);
    });
    self.DNL_CD.on('dataBound', /*97731c64-14b3-4865-9735-194681c78b19*/ function (e) {
    
    });
    self.START_DT.on('change', /*ccc4611e-cf21-4ae8-8948-d969f46f8c87*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
    });
    self.END_DT.on('change', /*a139e6fd-50ba-44f9-b311-e7d4e459801d*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
    });
    self.$REASON_DC.on('change', /*6fbf625f-c7be-46c0-973b-2fc0932200a0*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
    });
    self.$ATHZ_ST_NM.on('change', /*1c610c93-aae0-41c7-acdf-94d47324e4d1*/ function (e) {
    
    });
    dews.ui.grid(self.$main_grid, {
      dataSource: self.main_ds,
      sortable: false,
      autoBind: false,
      checkable: false,
      copyMode: 'cell',
      columns: [
        {
          field: 'COMPANY_CD',
          title: '회사코드',
          width: 80
        },
        {
          field: 'REQ_NO',
          title: '신청번호',
          width: 60
        },
        {
          field: 'REQ_DT',
          title: '신청일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'DNLGB_CD',
          title: '근태구분코드',
          width: 80
        },
        {
          field: 'DNL_CD',
          title: '근태코드',
          width: 80,
          formats: {
            type: 'dataSource',
            dataSource: self.dnl_ds,
            dataValueField: 'HR_CD',
            dataTextField: 'HR_CD_NM'
          }
        },
        {
          field: 'START_DT',
          title: '시작일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'END_DT',
          title: '종료일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'ATHZ_DOC_CD',
          title: '결재문서코드',
          width: 80
        },
        {
          field: 'ATHZ_ST_CD',
          title: '결재상태코드',
          width: 80
        },
        {
          field: 'EMP_NO',
          title: '사원번호',
          width: 60
        },
        {
          field: 'KOR_NM',
          title: '한글명',
          width: 90,
          align: 'left'
        },
        {
          field: 'PSTN_CD',
          title: '직급코드',
          width: 80
        },
        {
          field: 'OGRP_CD',
          title: '직군코드',
          width: 80
        },
        {
          field: 'DEPT_CD',
          title: '부서코드',
          width: 80
        },
        {
          field: 'ORG',
          title: '소속',
          width: 60
        },
        {
          field: 'POSI_CD',
          title: '직위코드',
          width: 80
        },
        {
          field: 'REQ_EMP_NO',
          title: '신청사원번호',
          width: 60
        },
        {
          field: 'REQ_KOR_NM',
          title: '신청사원이름',
          width: 90,
          align: 'left'
        },
        {
          field: 'REASON_DC',
          title: '사유내역',
          width: 120,
          align: 'left'
        },
        {
          field: 'REQ_DY',
          title: '신청일수',
          width: 60
        }
      ],
      fixed: {
        colCount: 0,
        rightColCount: 0
      },
      change: /*c04e9cc0-71cf-4547-95b0-7d9c0086bb38*/ function (e) {
            self.userInfo_formpanel.bindTo(self.main_grid);
            self.sub_formpanel.bindTo(self.main_grid);
        }
    ,
      dataBound: /*ed8e6da1-4b37-4159-9ad7-d1e40519430c*/ function (e) {
            self.userInfo_formpanel.bindTo(self.main_grid);
            self.sub_formpanel.bindTo(self.main_grid);
        }
    
    });
    
    
    
    
    /*cdd3d4f4-7ecd-43e5-9538-0f8096f35ab0*/ InitData();
    
    function InitData() {
        try {
    
            // isExist: isExist,
            // userData: userData
            var isExist = self.initialData.isExist;
            var userData = self.initialData.userData;
            //만약 이미 존재하는 이력이라면 => 조회
            if (isExist) {
                //파라미터로 넘겨 받은 데이터를 폼패널에 바인딩
                self.userInfo_formpanel.bindData(userData);
                self.sub_formpanel.bindData(userData);
                self.ATHZ_ST_NM.text(GetATHZ_ST_NM());
                self.REQ_DT.text(userData.REQ_DT);
    
    
                //만약 REQ_EMP_NO와 REQ_KOR_NM이 공백이라면 기본정보의 데이터 바인딩
                if (self.REQ_EMP_NO.text() === '' && self.REQ_KOR_NM.text() === '') {
                    self.REQ_EMP_NO.text(userData.EMP_NO);
                    self.REQ_KOR_NM.text(userData.KOR_NM);
                }
    
                //데이터소스에서 조회된 값이 아닌 파라미터로 넘겨받은 데이터를 그리드에 바인딩.
                self.main_grid.addRow();
                self.userInfo_formpanel.bindTo(self.main_grid);
                self.sub_formpanel.bindTo(self.main_grid);
    
                //보여지지 않는 컬럼에 대한 데이터 초기화
                self.main_grid.setCellValue(0, 'REQ_NO', userData.REQ_NO);
                self.main_grid.setCellValue(0, 'REQ_DT', userData.REQ_DT);
                self.main_grid.setCellValue(0, 'DEPT_CD', userData.DEPT_CD);
                self.main_grid.setCellValue(0, 'DNL_CD', userData.DNL_CD);
                self.main_grid.setCellValue(0, 'REQ_DY', userData.REQ_DY);
                self.main_grid.setCellValue(0, 'ATHZ_DOC_CD', userData.ATHZ_DOC_CD);
                self.main_grid.setCellValue(0, 'DNLGB_CD', userData.DNLGB_CD);
            }
        } catch (error) {
            dews.error(error);
            console.error(error);
        }
    }
    
    function GetATHZ_ST_NM() {
        var status = '';
    
        switch (self.initialData.userData.ATHZ_ST_CD) {
            case '1':
                status = '임시저장';
                break;
            case '2':
                status = '결재대기';
                break;
            case '3':
                status = '반려';
                break;
            case '4':
                status = '결재완료';
                break;
            default:
                status = '';
                break;
        }
    
        return status;
    
    }
    
    //신청자 변경 시 기본정보도 함께 변경될 수 있도록 사원정보를 불러오는 함수
    function GetUserInfo(emp_no, company_cd) {
        dews.api.get(dews.url.getApiUrl("HR", "HREssodm01400_X10005Service", "getUserInfo"), {
            async: false,
            data: {
                emp_no: emp_no,
                company_cd: company_cd
            }
        }).done(function (data) {
            var grid = self.main_grid;
            grid.setCellValue(grid.select(), 'EMP_NO', data[0].EMP_NO, false); // 사원번호
            grid.setCellValue(grid.select(), 'KOR_NM', data[0].KOR_NM, false); // 한글명
            grid.setCellValue(grid.select(), 'PSTN_CD', data[0].PSTN_CD, false); // 직급코드
            grid.setCellValue(grid.select(), 'OGRP_CD', data[0].OGRP_CD, false); // 직군코드
            grid.setCellValue(grid.select(), 'ORG', data[0].ORG, false); // 소속
            grid.setCellValue(grid.select(), 'POSI_CD', data[0].POSI_CD, false); // 직위코드
            self.EMP_NO.text(data[0].EMP_NO);
            self.KOR_NM.text(data[0].KOR_NM);
            self.PSTN_CD.text(data[0].PSTN_CD);
            self.OGRP_CD.text(data[0].OGRP_CD);
            self.ORG.text(data[0].ORG);
            self.POSI.text(data[0].POSI_CD);
        }).fail(function (xhr, status, error) {
            dews.error(xhr.responseJSON.message);
        });
    }
    
    

  
  });

</script>