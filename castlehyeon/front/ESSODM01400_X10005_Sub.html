<!--##d06d709d-4561-42f0-a5d3-07eb9f00c6fa##-->
<!--##ESSODM01400_X10005_Sub##-->
<!--##gjfRfSw+nFQRA4TC3uClHqKokPIBofjngCn71vCjTg1W5skYVWya0VfF3yJ8ASsv##-->
<!--
  DEWS UI/UX IDE - Build Result - v1.5
  # PageID: ESSODM01400_X10005_Sub
  # PageTitle: 결근계 신청 상세내역
  # Server: http://localhost:8080/
-->
<!--

-->

<div id="containerpanel1" class="dews-ui-container-panel" data-dews-fit-bottom="true">
  <div id="containerpanelitem1" class="dews-container-item" data-dews-position="normal">
    <h4 id="tit1" class="dews-ui-title">기본정보</h4>
    <div id="userInfo_formpanel" class="dews-ui-form-panel" data-dews-columns="4">
      <ul>
        <li>
          <label>사번</label>
          <span>
            <input id="EMP_NO" name="EMP_NO" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>성명</label>
          <span>
            <input id="KOR_NM" name="KOR_NM" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>직급</label>
          <span>
            <input id="PSTN_CD" name="PSTN_CD" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>직군</label>
          <span>
            <input id="OGRP_CD" name="OGRP_CD" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li class="col-3">
          <label>소속</label>
          <span>
            <input id="ORG" name="ORG" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li>
          <label>직위</label>
          <span>
            <input id="POSI_CD" name="POSI_CD" type="text" class="dews-ui-textbox basic" readonly="readonly" />
          </span>
        </li>
        <li style="display: none;">
          <label>라벨</label>
          <span>
            <input id="COMPANY_CD" name="COMPANY_CD" type="text" class="dews-ui-textbox basic" />
          </span>
        </li>
        <li style="display: none;">
          <label>라벨</label>
          <span>
            <input type="text" id="s_EMP_NO" name="s_EMP_NO" class="dews-ui-codepicker basic" data-dews-help-code="H_HR_EMP_MST_S" data-dews-help-title="사원 도움창" data-dews-help-custom="false" data-dews-help-size="big" data-dews-ajax="true" />
          </span>
        </li>
      </ul>
    </div>
    <div class="dews-button-group" style="text-align: right;">
      <button id="temp_save_button" class="dews-ui-button">임시 저장</button>
      <button id="req_button" class="dews-ui-button">결재 요청</button>
      <button id="req_cancel_button" class="dews-ui-button">결재요청 취소</button>
      <button id="delete_button" class="dews-ui-button">삭제</button>
      <button id="sub_close_button" class="dews-ui-button">목록</button>
    </div>
    <h4 id="tit3" class="dews-ui-title">결근계 신청 상세내역</h4>
    <div id="sub_formpanel" class="dews-ui-form-panel" data-dews-columns="3">
      <ul>
        <li class="col-3">
          <label>신청자</label>
          <span>
            <input id="REQ_EMP_NO" name="REQ_EMP_NO" type="text" class="dews-ui-textbox" readonly="readonly" style="width: 100px;" />
            <input id="REQ_KOR_NM" name="REQ_KOR_NM" type="text" class="dews-ui-textbox" readonly="readonly" style="width: 100px;" />
            <button id="CHANGE_REQ_USERT" class="dews-ui-button">신청자변경</button>
          </span>
        </li>
        <li class="col-3">
          <label>근태종류</label>
          <span>
            <select id="DNL_CD" name="DNL_CD" class="dews-ui-dropdownlist required" data-dews-value-field="HR_CD" data-dews-text-field="HR_CD_NM" data-dews-show-tooltip="true" style="width: 204px;" data-dews-show-value-tooltip="true" data-dews-use-numkey="false"></select>
          </span>
        </li>
        <li>
          <label>시작일</label>
          <span>
            <input type="text" id="START_DT" name="START_DT" class="dews-ui-datepicker required" />
          </span>
        </li>
        <li class="col-2">
          <label>종료일</label>
          <span>
            <input type="text" id="END_DT" name="END_DT" class="dews-ui-datepicker required" style="width: 175px;" />
          </span>
        </li>
        <li class="col-3">
          <label>사유</label>
          <span>
            <input id="REASON_DC" name="REASON_DC" type="text" class="dews-ui-textbox required" style="width: 500px;" />
          </span>
        </li>
        <li class="col-3">
          <label>결재상태</label>
          <span>
            <input id="ATHZ_ST_NM" name="ATHZ_ST_NM" type="text" class="dews-ui-textbox basic" readonly="readonly" style="width: 170px;" />
          </span>
        </li>
        <li>
          <label>신청일</label>
          <span>
            <input type="text" id="REQ_DT" name="REQ_DT" class="dews-ui-datepicker basic" readonly="readonly" />
          </span>
        </li>
        <li style="display: none;">
          <label>라벨</label>
          <span>
            <input id="ATHZ_ST_CD" name="ATHZ_ST_CD" type="text" class="dews-ui-textbox basic" />
          </span>
        </li>
      </ul>
    </div>
    <div id="main_grid" class="dews-ui-grid"></div>
  </div>
</div>

<style>
    
</style>



<script>
  dews.ready(function () {
    var self = this;
    self.version = self.version || {};
    self.version.view='1.0';


    /*b86609c9-3017-4aef-896e-65022e1080a4*/ //# sourceURL=ESSODM01400_x10005_Sub.js
    self.COMPANY_CD.text(self.user.companyCode);
    
    
    
    self.sub_userInfo_ds = dews.ui.dataSource('sub_userInfo_ds', {
      grid: true,
      transport: {
        read: {
          url: dews.url.getApiUrl('HR', 'HREssodm01400_X10005Service', 'getUserInfo')
        }
      },
      schema: {
        model: {
          fields: [
            { field: 'EMP_NO', editable: false, dataType: 'string' }, 
            { field: 'KOR_NM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'OGRP_CD', editable: false, dataType: 'string' }, 
            { field: 'ORG', editable: false, dataType: 'string' }, 
            { field: 'POSI_CD', editable: false, dataType: 'string' }, 
            { field: 'BIZAREA_CD', editable: false, dataType: 'string' }, 
            { field: 'DEPT_NM', editable: false, dataType: 'string' }, 
            { field: 'GRP_NM', editable: false, dataType: 'string' }, 
            { field: 'BIZAREA_NM', editable: false, dataType: 'string' }, 
            { field: 'PATH', editable: false, dataType: 'string' }, 
            { field: 'DEPT_CD', editable: false, dataType: 'string' }
          ]
    
        }
      }
    });
    self.main_ds = dews.ui.dataSource('main_ds', {
      grid: true,
      transport: {
        read: {
          url: dews.url.getApiUrl('HR', 'HREssodm01400_X10005Service', 'list_HR_OFFAPPLY_MST_X10005MST'),
          data: function () {
            return {
              start_dt: self.START_DT.value(),
              end_dt: self.END_DT.value(),
              company_cd: self.COMPANY_CD.text()
            };
          }
        }
      },
      schema: {
        model: {
          fields: [
            { field: 'COMPANY_CD', editable: false, dataType: 'string' }, 
            { field: 'REQ_NO', editable: false, dataType: 'string' }, 
            { field: 'REQ_DT', editable: false, dataType: 'string' }, 
            { field: 'DNLGB_CD', editable: false, dataType: 'string' }, 
            { field: 'DNL_CD', editable: false, dataType: 'string' }, 
            { field: 'START_DT', editable: false, dataType: 'string' }, 
            { field: 'END_DT', editable: false, dataType: 'string' }, 
            { field: 'ATHZ_DOC_CD', editable: false, dataType: 'string' }, 
            { field: 'ATHZ_ST_CD', editable: false, dataType: 'string' }, 
            { field: 'EMP_NO', editable: false, dataType: 'string' }, 
            { field: 'KOR_NM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'OGRP_CD', editable: false, dataType: 'string' }, 
            { field: 'DEPT_CD', editable: false, dataType: 'string' }, 
            { field: 'ORG', editable: false, dataType: 'string' }, 
            { field: 'POSI_CD', editable: false, dataType: 'string' }, 
            { field: 'REQ_EMP_NO', editable: false, dataType: 'string' }, 
            { field: 'REQ_KOR_NM', editable: false, dataType: 'string' }, 
            { field: 'REASON_DC', editable: false, dataType: 'string' }, 
            { field: 'REQ_DY', editable: false, dataType: 'number' }, 
            { field: 'BIZAREA_CD', editable: false, dataType: 'string' }
          ]
    
        }
      }
    });
    self.dnl_ds = dews.ui.dataSource('dnl_ds', {
      schema: {
        model: {
          fields: [
            { field: 'HR_CD', editable: false, type: 'string' }, 
            { field: 'HR_CD_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{ HR_CD: "5100", HR_CD_NM: "유계결근[10일 이내]"},
    { HR_CD: "5101", HR_CD_NM: "유계결근[10일 초과]"},
    { HR_CD: "5102", HR_CD_NM: "유계결근[30일 초과]"}]
    });
    self.athz_st_ds = dews.ui.dataSource('athz_st_ds', {
      schema: {
        model: {
          fields: [
            { field: 'DNL_CD', editable: false, type: 'string' }, 
            { field: 'DNL_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{ DNL_CD: "1", DNL_NM: "임시저장"},
    { DNL_CD: "2", DNL_NM: "결재대기"},
    { DNL_CD: "3", DNL_NM: "반려"},
    { DNL_CD: "4", DNL_NM: "결재완료"}]
    });
    
    
    dews.ui.mainbuttons.localize.disable(true);
    self.s_EMP_NO.on('codedialog', /*bac2ec72-9198-4777-905f-fcea45bac730*/ function (e) {
        e.callback = function (s) {
            // self.REQ_EMP_NO.text(s.EMP_NO);
            // self.REQ_KOR_NM.text(s.KOR_NM);
            // self.main_grid.setCellValue(self.main_grid.select(), 'REQ_EMP_NO', s.EMP_NO);
            // self.main_grid.setCellValue(self.main_grid.select(), 'REQ_KOR_NM', s.KOR_NM);
            GetUserInfo(s.EMP_NO, s.COMPANY_CD);
    
        }
    });
    self.s_EMP_NO.setHelpParams(function () {
      return {
        company_cd: self.COMPANY_CD.text()
      };
    });
    self.$temp_save_button.on('click', /*e07a479f-2584-47d9-9db3-60a574b7f674*/ function (e) {
        var grid = self.main_grid;
        var athz_st_cd = self.ATHZ_ST_CD.text();
        var userData = self.initialData.userData;
    
        //결재상태 코드값에 따라서 알림 메시지 처리
        if (athz_st_cd == "1") {
            SaveTempData();
        } else if (athz_st_cd == "2") {
            SaveTempData();
            dews.alert("결재대기 중입니다.", "warning");
        } else if (athz_st_cd == "3") {
            SaveTempData();
            dews.alert("결재반려 되었습니다.", "warning");
        } else if (athz_st_cd == "4") {
            SaveTempData();
            dews.alert("결재완료 되었습니다.", "warning");
        } else {
            SaveTempData();
            grid.commitCell();
        }
    
    });
    self.$delete_button.on('click', /*4d8e17ac-e695-4e96-93b8-5762ecd28545*/ function (e) {
        var req_no = self.main_grid.getCellValue(0, 'REQ_NO');
        var company_cd = self.COMPANY_CD.text();
        dews.confirm('삭제하시겠습니까?', "question").yes(function () {
            if (req_no == "") {
                dews.ui.snackbar.error('존재하지 않는 문서입니다.');
                return;
            }
            else {
                dews.api.get(dews.url.getApiUrl("HR", "HREssodm01400_X10005Service", "delete_HR_OFFAPPLY_MST_X10005MST"), {
                    async: false,
                    data: {
                        req_no: req_no,
                        company_cd: company_cd
                    }
                }).done(function (data) {
                    if (data == 'OK') {
                        dews.ui.snackbar.ok('삭제되었습니다.');
                        dews.ui.page.close(); // 현재 서브페이지 닫기
                    } else
                        dews.ui.snackbar.warning(data);
                }).fail(function (e) {
                    dews.ui.snackbar.error('삭제하는데 실패하였습니다.');
                });
            }
        }).no(function () {
        });
    });
    self.$sub_close_button.on('click', /*64036093-15ee-4515-9241-24b3b54e6681*/ function (e) {
        //   if (self.absData_ds.getDirtyDataCount() > 0) {
        //     dews.confirm('저장되지 않은 데이터가 있습니다.\n그래도 이동 하시겠습니까?', "question").yes(function () {
        //       dews.ui.page.close();
        //     }).no(function () {
        //     });
        //   } else {
        dews.ui.page.close();
        //   }
    
    });
    self.$REQ_EMP_NO.on('change', /*1f1fac4a-039e-4381-8e09-422d31b52d2d*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
        GetOriginData();
    });
    self.$REQ_KOR_NM.on('change', /*7d0bb8eb-1fce-45ec-a9a2-7857091a706a*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
        GetOriginData();
    });
    self.$CHANGE_REQ_USERT.on('click', /*10c3134e-6820-4e85-a391-74ef74a1d7bd*/ function (e) {
        self.s_EMP_NO.open();
    });
    self.DNL_CD.setDataSource(self.dnl_ds);
    self.DNL_CD.on('change', /*2ddf2b3d-9672-4e5d-b425-5479d04a1352*/ function (e) {
        self.main_grid.setCellValue(self.main_grid.select(), 'DNL_CD', self.DNL_CD.value(), false);
    });
    self.DNL_CD.on('dataBound', /*97731c64-14b3-4865-9735-194681c78b19*/ function (e) {
    
    });
    self.START_DT.on('change', /*ccc4611e-cf21-4ae8-8948-d969f46f8c87*/ function (e) {
        self.main_grid.setCellValue(self.main_grid.select(), 'REQ_DY', GetREQ_DY());
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
        GetOriginData();
    });
    self.END_DT.on('change', /*a139e6fd-50ba-44f9-b311-e7d4e459801d*/ function (e) {
        self.main_grid.setCellValue(self.main_grid.select(), 'REQ_DY', GetREQ_DY());
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
        GetOriginData();
    });
    self.$REASON_DC.on('change', /*6fbf625f-c7be-46c0-973b-2fc0932200a0*/ function (e) {
        self.userInfo_formpanel.bindTo(self.main_grid);
        self.sub_formpanel.bindTo(self.main_grid);
        GetOriginData();
    });
    self.$ATHZ_ST_NM.on('change', /*1c610c93-aae0-41c7-acdf-94d47324e4d1*/ function (e) {
    
    });
    dews.ui.grid(self.$main_grid, {
      dataSource: self.main_ds,
      sortable: false,
      autoBind: false,
      checkable: false,
      copyMode: 'cell',
      columns: [
        {
          field: 'COMPANY_CD',
          title: '회사코드',
          width: 80
        },
        {
          field: 'REQ_NO',
          title: '신청번호',
          width: 60
        },
        {
          field: 'REQ_DT',
          title: '신청일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'DNLGB_CD',
          title: '근태구분코드',
          width: 80
        },
        {
          field: 'DNL_CD',
          title: '근태코드',
          width: 80,
          formats: {
            type: 'dataSource',
            dataSource: self.dnl_ds,
            dataValueField: 'HR_CD',
            dataTextField: 'HR_CD_NM'
          }
        },
        {
          field: 'START_DT',
          title: '시작일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'END_DT',
          title: '종료일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'ATHZ_DOC_CD',
          title: '결재문서코드',
          width: 80
        },
        {
          field: 'ATHZ_ST_CD',
          title: '결재상태코드',
          width: 80
        },
        {
          field: 'EMP_NO',
          title: '사원번호',
          width: 60
        },
        {
          field: 'KOR_NM',
          title: '한글명',
          width: 90,
          align: 'left'
        },
        {
          field: 'PSTN_CD',
          title: '직급코드',
          width: 80
        },
        {
          field: 'OGRP_CD',
          title: '직군코드',
          width: 80
        },
        {
          field: 'DEPT_CD',
          title: '부서코드',
          width: 80
        },
        {
          field: 'ORG',
          title: '소속',
          width: 60
        },
        {
          field: 'POSI_CD',
          title: '직위코드',
          width: 80
        },
        {
          field: 'REQ_EMP_NO',
          title: '신청사원번호',
          width: 60
        },
        {
          field: 'REQ_KOR_NM',
          title: '신청사원이름',
          width: 90,
          align: 'left'
        },
        {
          field: 'REASON_DC',
          title: '사유내역',
          width: 120,
          align: 'left'
        },
        {
          field: 'REQ_DY',
          title: '신청일수',
          width: 60
        },
        {
          field: 'BIZAREA_CD',
          title: '사업장코드',
          width: 80
        }
      ],
      fixed: {
        colCount: 0,
        rightColCount: 0
      },
      change: /*c04e9cc0-71cf-4547-95b0-7d9c0086bb38*/ function (e) {
            self.userInfo_formpanel.bindTo(self.main_grid);
            self.sub_formpanel.bindTo(self.main_grid);
            GetOriginData();
        }
    ,
      dataBound: /*ed8e6da1-4b37-4159-9ad7-d1e40519430c*/ function (e) {
            self.userInfo_formpanel.bindTo(self.main_grid);
            self.sub_formpanel.bindTo(self.main_grid);
            GetOriginData();
        }
    
    });
    
    
    
    
    /*cdd3d4f4-7ecd-43e5-9538-0f8096f35ab0*/ InitData();
    
    function InitData() {
        try {
    
            // isExist: isExist,
            // userData: userData
            var isExist = self.initialData.isExist;
            var userData = self.initialData.userData;
            //만약 이미 존재하는 이력이라면 => 조회
            if (isExist) {
                //파라미터로 넘겨 받은 데이터를 폼패널에 바인딩
                self.userInfo_formpanel.bindData(userData);
                self.sub_formpanel.bindData(userData);
                self.ATHZ_ST_NM.text(GetATHZ_ST_NM());
                self.REQ_DT.text(userData.REQ_DT);
                GetUserInfo(self.EMP_NO.text(), self.COMPANY_CD.text());
    
    
                //만약 REQ_EMP_NO와 REQ_KOR_NM이 공백이라면 기본정보의 데이터 바인딩
                if (self.REQ_EMP_NO.text() === '' && self.REQ_KOR_NM.text() === '') {
                    self.REQ_EMP_NO.text(self.user.empCode);
                    self.REQ_KOR_NM.text(self.user.username);
                }
    
                //직급, 직위에 대한 기본값 설정
                self.PSTN_CD.text(userData.PSTN_CD === undefined || userData.PSTN_CD === '' ? '연구원' : userData.PSTN_CD); //직급
                self.POSI_CD.text(userData.POSI_CD === undefined || userData.POSI_CD === '' ? '사원' : userData.POSI_CD); // 직위
                //데이터소스에서 조회된 값이 아닌 파라미터로 넘겨받은 데이터를 그리드에 바인딩.
                self.main_grid.addRow();
                self.userInfo_formpanel.bindTo(self.main_grid);
                self.sub_formpanel.bindTo(self.main_grid);
    
                //보여지지 않는 컬럼에 대한 데이터 초기화
                self.main_grid.setCellValue(0, 'REQ_NO', userData.REQ_NO);
                self.main_grid.setCellValue(0, 'REQ_DT', userData.REQ_DT);
                self.main_grid.setCellValue(0, 'DEPT_CD', userData.DEPT_CD);
                self.main_grid.setCellValue(0, 'DNL_CD', userData.DNL_CD);
                self.main_grid.setCellValue(0, 'ATHZ_DOC_CD', userData.ATHZ_DOC_CD);
                self.main_grid.setCellValue(0, 'DNLGB_CD', userData.DNLGB_CD);
                self.main_grid.setCellValue(0, 'REQ_DY', GetREQ_DY());
                self.main_grid.setCellValue(0, 'BIZAREA_CD', userData.BIZAREA_CD);
    
                //직급, 직위는 undefined라면 보여지는 임시값이므로 공백으로 바로 넣어주어야함.
                self.main_grid.setCellValue(0, 'PSTN_CD', userData.PSTN_CD);
                self.main_grid.setCellValue(0, 'POSI_CD', userData.POSI_CD);
            } else {
                self.main_grid.addRow();
                //기본정보 패널
                // self.EMP_NO.text(self.user.empCode);
                // self.KOR_NM.text(self.user.username);
                // self.PSTN_CD.text(self.user.dutyRankCode === undefined ? '연구원' : self.user.dutyRankCode); //직급
                // self.OGRP_CD.text(self.user.gaapCode); // 직군
                // self.ORG.text(self.user.profitCenterName + "/" + self.user.groupName + "/" + self.user.deptName); //소속
                // self.POSI_CD.text(self.user.dutyCode === undefined ? '사원' : self.user.dutyCode); // 직위
                // self.COMPANY_CD.text(self.user.companyCode); //회사코드
                GetUserInfo(self.user.empCode, self.user.companyCode);
    
                //신청자 패널
                self.REQ_EMP_NO.text(self.user.empCode); //사원번호
                self.REQ_KOR_NM.text(self.user.username); //이름
                self.REQ_DT.value(new Date()); //오늘 날짜
    
                //보여지지 않는 컬럼에 대한 데이터 초기화
                // self.main_grid.setCellValue(0, 'REQ_NO', userData.REQ_NO);
                // self.main_grid.setCellValue(0, 'REQ_DT', userData.REQ_DT);
                self.main_grid.setCellValue(0, 'DEPT_CD', self.user.deptCode);
                self.main_grid.setCellValue(0, 'DNL_CD', '5100'); //기본값
                // self.main_grid.setCellValue(0, 'REQ_DY', userData.REQ_DY);
                // self.main_grid.setCellValue(0, 'ATHZ_DOC_CD', userData.ATHZ_DOC_CD);
                self.main_grid.setCellValue(0, 'DNLGB_CD', '400');
                self.main_grid.setCellValue(0, 'REQ_DY', GetREQ_DY());
                self.main_grid.setCellValue(0, 'BIZAREA_CD', self.user.bizAreaCode);
                self.main_grid.setCellValue(0, 'REQ_NO', '');
    
                //폼패널 데이터를 그리드에 바인딩
                self.userInfo_formpanel.bindTo(self.main_grid);
                self.sub_formpanel.bindTo(self.main_grid);
    
                //직급, 직위는 undefined라면 보여지는 임시값이므로 공백으로 바로 넣어주어야함.
                self.main_grid.setCellValue(0, 'PSTN_CD', self.user.dutyRankCode);
                self.main_grid.setCellValue(0, 'POSI_CD', self.user.dutyCode);
            }
        } catch (error) {
            dews.error(error);
            console.error(error);
        }
    }
    
    function GetATHZ_ST_NM() {
        var status = '';
    
        switch (self.initialData.userData.ATHZ_ST_CD) {
            case '1':
                status = '임시저장';
                break;
            case '2':
                status = '결재대기';
                break;
            case '3':
                status = '반려';
                break;
            case '4':
                status = '결재완료';
                break;
            default:
                status = '';
                break;
        }
    
        return status;
    
    }
    
    function GetREQ_DY() {
        // var userData = self.initialData.userData;
        var cal_dy
    
        if (startDateStr != '' && endDateStr != '') {
            var startDateStr = self.START_DT.text(); // 예시: YYYYMMDD 형식
            var endDateStr = self.END_DT.text();
    
            // 시작날짜와 종료날짜를 Date 객체로 변환
            var startDate = new Date(startDateStr);
            var endDate = new Date(endDateStr);
    
            // 날짜가 앞선 경우 -1을 리턴
            if (endDate < startDate) {
                return -1;
            }
    
            var timeDiff = endDate - startDate;
    
            // 일 수 계산 (시작날짜와 종료날짜 포함)
            cal_dy = Math.floor(timeDiff / (1000 * 60 * 60 * 24)) + 1;
        }
        return cal_dy;
    }
    
    //신청자 변경 시 기본정보도 함께 변경될 수 있도록 사원정보를 불러오는 함수
    function GetUserInfo(emp_no, company_cd) {
        dews.api.get(dews.url.getApiUrl("HR", "HREssodm01400_X10005Service", "getUserInfo"), {
            async: false,
            data: {
                emp_no: emp_no,
                company_cd: company_cd
            }
        }).done(function (data) {
            var grid = self.main_grid;
            grid.setCellValue(grid.select(), 'EMP_NO', data[0].EMP_NO, false); // 사원번호
            grid.setCellValue(grid.select(), 'KOR_NM', data[0].KOR_NM, false); // 한글명
            grid.setCellValue(grid.select(), 'PSTN_CD', data[0].PSTN_CD === null ? '연구원' : data[0].PSTN_CD, false); // 직급코드
            grid.setCellValue(grid.select(), 'OGRP_CD', data[0].OGRP_CD, false); // 직군코드
            grid.setCellValue(grid.select(), 'ORG', data[0].ORG === null ? data[0].PATH : data[0].ORG, false); // 소속
            grid.setCellValue(grid.select(), 'POSI_CD', data[0].POSI_CD === undefined ? '사원' : data[0].POSI_CD, false); // 직위코드
            grid.setCellValue(grid.select(), 'DEPT_CD', data[0].DEPT_CD, false);
            self.EMP_NO.text(data[0].EMP_NO);
            self.KOR_NM.text(data[0].KOR_NM);
            self.PSTN_CD.text(data[0].PSTN_CD === null ? '연구원' : data[0].PSTN_CD);
            self.OGRP_CD.text(data[0].OGRP_CD);
            self.ORG.text(data[0].ORG === null ? data[0].PATH : data[0].ORG);
            self.POSI_CD.text(data[0].POSI_CD === null ? '사원' : data[0].POSI_CD);
        }).fail(function (xhr, status, error) {
            dews.error(xhr.responseJSON.message);
        });
    }
    
    //파이프 데이터소스에서 생성한 것처럼 드롭다운리스트에서 값의 범위에 따라 유효성 검증
    function CheckPeriod() {
        var req_date = GetREQ_DY();
        if (req_date < 0) {           // 신청가능일 < 10
            dews.ui.snackbar.warning("종료일은 시작일보다 작을 수 없습니다.");
            return false;
        } else if (self.DNL_CD.value() === '5100') {           // 신청가능일 < 10
            if (req_date > 10) {
                dews.ui.snackbar.warning("10일 이내로 신청해야 합니다. 현재 신청일 : " + req_date + "일");
                return false;
            }
        } else if (self.DNL_CD.value() === '5101') {           // 11 < 신청가능일 < 30
            if (req_date < 11 || req_date > 30) {
                dews.ui.snackbar.warning("11~30일 이내로 신청해야 합니다. 현재 신청일 : " + req_date + "일");
                return false;
            }
        } else if (self.DNL_CD.value() === '5102') {    // 신청가능일 < 30 
            if (req_date < 31) {
                dews.ui.snackbar.warning("31일 이상 신청해야 합니다. 현재 신청일 : " + req_date + "일");
                return false;
            }
        }
        return true;
    }
    
    //임시저장을 눌렀을 때 신규 || 기존에 따라 데이터 처리
    function SaveTempData() {
        var userData = self.initialData.userData;
        var isExist = self.initialData.isExist;
    
        if (self.sub_formpanel.validate({ tooltip: true, message: '필수 항목을 입력 해주세요.' })) {
            //드롭다운리스트의 날짜 기준에 맞게 시작일과 종료일이 설정되었는지 유효성 검사
            if (!CheckPeriod()) { return false; }
    
            //기존 데이터 조회 시
            if (isExist === true) {
                if (self.main_ds.getDirtyDataCount() <= 0) {
                    dews.ui.snackbar.warning("변경된 내용이 없습니다.");
                } else {
                    dews.api.get(dews.url.getApiUrl("HR", "HREssodm01400_X10005Service", "update_HR_OFFAPPLY_MST_X10005MST"), {
                        async: false,
                        data: {
                            //기본키
                            company_cd: self.COMPANY_CD.text(),//회사코드
                            req_no: self.main_grid.getCellValue(0, 'REQ_NO'), // 신청번호
    
    
                            //소속 (사업장/부서)
                            bizarea_cd: self.main_grid.getCellValue(0, 'BIZAREA_CD'), //사업장코드
                            dept_cd: self.main_grid.getCellValue(0, 'DEPT_CD'),
    
                            //결근 대상자 정보
                            emp_no: self.EMP_NO.text(),  // 결근 대상자 사원번호
                            pstn_cd: self.main_grid.getCellValue(0, 'PSTN_CD'), // 결근 대상자 직급코드
                            ogrp_cd: self.main_grid.getCellValue(0, 'OGRP_CD'), // 직군코드
                            posi_cd: self.main_grid.getCellValue(0, 'POSI_CD'), // 직위 코드
    
                            //결근 신청자 정보
                            req_emp_no: self.REQ_EMP_NO.text(), // 결근 신청하는(현재 로그인한) 사원번호
                            dnl_cd: self.DNL_CD.value(), // 현재 선택되어 있는 드랍다운리스트의 value 값
                            start_dt: self.START_DT.value(),
                            end_dt: self.END_DT.value(),
                            req_dy: self.main_grid.getCellValue(0, 'REQ_DY'),
                            reason_dc: self.main_grid.getCellValue(0, 'REASON_DC')
    
                            //한번에 모델로 보내기 => dirtyData 상에서 added로 들어가는 문제점
                            // main_ds: main_ds
                        }
                    }).done(function (data) {
                        if (data == 'already_existed') {
                            dews.ui.snackbar.warning("해당 기간에 근태내역이 있습니다.");
                            return;
                        }
                        if (data !== 'OK') {
                            dews.ui.snackbar.warning(data);
                            return;
                        }
                        dews.ui.snackbar.ok("임시 저장 되었습니다.");
                        // dews.ui.page.close(); // 페이지 닫기
                    });
                }
            } else if (isExist === false) {
                dews.api.get(dews.url.getApiUrl("HR", "HREssodm01400_X10005Service", "insert_HR_OFFAPPLY_MST_X10005MST"), {
                    async: false,
                    data: {
                        company_cd: self.COMPANY_CD.text(),
                        req_no: self.main_grid.getCellValue(0, 'REQ_NO'), // 신청번호
                        req_dt: self.REQ_DT.value(),
                        start_dt: self.START_DT.value(),
                        end_dt: self.END_DT.value(),
                        emp_no: self.EMP_NO.text(),  // 결근 대상자 사원번호
                        req_emp_no: self.REQ_EMP_NO.text(), // 결근 신청하는(현재 로그인한) 사원번호
                        dnl_cd: self.DNL_CD.value(), // 현재 선택되어 있는 드랍다운리스트의 value 값
                        reason_dc: self.REASON_DC.text(),
                        req_dy: self.main_grid.getCellValue(0, 'REQ_DY'),
                        bizarea_cd: self.main_grid.getCellValue(0, 'BIZAREA_CD'),
                        dept_cd: self.main_grid.getCellValue(0, 'DEPT_CD'),
                        pstn_cd: self.main_grid.getCellValue(0, 'PSTN_CD'),
                        ogrp_cd: self.main_grid.getCellValue(0, 'OGRP_CD'),
                        posi_cd: self.main_grid.getCellValue(0, 'POSI_CD'),
                        dnlgb_cd: self.main_grid.getCellValue(0, 'DNLGB_CD')
                    }
                }).done(function (data) {
                    if (data == 'already_existed') {
                        dews.ui.snackbar.warning("해당 기간에 근태내역이 있습니다.");
                        return;
                    }
                    // if (data !== 'OK') {
                    //     dews.ui.snackbar.warning(data[0]);
                    //     return;
                    // }
                    dews.ui.snackbar.ok("임시 저장 되었습니다.");
                    self.main_grid.setCellValue(0, 'REQ_NO', data, false);
                    self.main_grid.setCellValue(0, 'ATHZ_ST_CD', 1, false);
                    self.ATHZ_ST_NM.text('임시저장');
                    // dews.ui.page.close(); // 페이지 닫기
                    isExist = true;
                });
            }
        }
    }
    
    //직군, 직위 등의 임시값 대신 원래값으로 그리드에 저장해놓는 메서드
    //데이터가 바인딩 될 때마다 넣어주어야함.
    function GetOriginData() {
        self.main_grid.setCellValue(0, 'PSTN_CD', self.PSTN_CD.text() === '연구원' ? '' : self.PSTN_CD.text());
        self.main_grid.setCellValue(0, 'POSI_CD', self.POSI_CD.text() === '사원' ? '' : self.POSI_CD.text());
    }
    
    

  
  });

</script>