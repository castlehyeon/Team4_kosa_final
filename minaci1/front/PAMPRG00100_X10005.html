<!--##6eab578e-08d4-4c28-b364-52f3c630d20c##-->
<!--##PAMPRG00100_X10005##-->
<!--##mTv+SoXmJD8za85ZfuToi20H4SyQ5B4kvigtwimNKBBifhcSqoCXumvij83MOk/B##-->
<!--
  DEWS UI/UX IDE - Build Result - v1.5
  # PageID: PAMPRG00100_X10005
  # PageTitle: 승급기준표등록
  # Server: http://localhost:8080/
-->
<!--

-->

<div class="dews-button-group" style="text-align: right;">
  <button id="copybtnApply" class="dews-ui-button">종전자료복사</button>
  <button id="downloadBtnTemplet" class="dews-ui-button">양식받기</button>
  <button id="downloadBtnData" class="dews-ui-button">엑셀다운로드</button>
  <button id="uploadBtnApply" class="dews-ui-button">엑셀업로드</button>
</div>
<div id="conditionpanel" class="dews-ui-condition-panel" data-dews-columns="2">
  <ul class="required-area">
    <li>
      <label class="dews-ui-multilingual">승급년월</label>
      <span>
        <input type="text" id="mpPROMO_YEAR_MONTH" name="mpPROMO_YEAR_MONTH" class="dews-ui-monthpicker required" style="width: 174px;" />
        <button id="aply_ym_btn" class="dews-ui-button ico-search"></button>
      </span>
    </li>
    <li>
      <label class="dews-ui-multilingual">사업장</label>
      <span>
        <select id="bizarea_cd" name="bizarea_cd" class="dews-ui-dropdownlist required" data-dews-value-field="BIZAREA_CD" data-dews-text-field="BIZAREA_NM" data-dews-show-tooltip="true" style="width: 174px;" data-dews-show-value-tooltip="true" data-dews-use-numkey="false"></select>
      </span>
    </li>
  </ul>
  <ul class="optional-area"></ul>
</div>
<div id="containerpanel1" class="dews-ui-container-panel" data-dews-container-height="263" data-dews-fit-bottom="true">
  <div id="containerpanelitem1" class="dews-container-item" data-dews-position="normal">
    <div id="gridMaster" class="dews-ui-grid"></div>
  </div>
</div>
<div id="excelFormGrid" class="dews-ui-grid"></div>
<div id="importExcelGrid" class="dews-ui-grid"></div>

<style>
    
</style>



<script>
  dews.ready(function () {
    var self = this;
    self.version = self.version || {};
    self.version.view='1.0';


    /*bf8a1f3b-4f27-439e-8495-a190c78bb027*/ //# sourceURL=PAMPRG00100_X10005.js
    var isDataBinding = false;
    
    self.mainButtons.delete.useDefaultConfirm = false;
    //사용자에게 기본으로 설정된 확인 메시지를 출력 후 확인 받았을 경우에만 핸들러를 실행합니다. (※ 생략가능 / 기본값: true)
    
    // PSTN_NM 처리
    var pstnNmMap = {
        '대표이사': 11,
        '감사': 13,
        '전무이사': 14,
        '이사': 16,
        '부장': 17,
        '차장': 18,
        '과장': 19,
        '대리': 20,
        '사원': 21
    };
    
    //학력
    var lecdMap = {
        '초등졸': 1,
        '중졸': 2,
        '고졸': 3,
        '전문대졸': 4,
        '대졸': 5,
        '대학원졸': 6
    };
    
    var bwrkMap = {
        'S': 10,
        'A': 9,
        'B': 8,
        'C': 7,
        'D': 6
    }
    
    function startProgress(totalDirtyData, onCompleted) {
        var progress = dews.ui.progress("progress6", {
            type: "circular",
            total: 100,
            target: "page",
        });
    
        var rowSizeInBytes = 84;
        var timePerByte = 0.111; //인터넷 환경에 따라 속도 다를 수 있음 
        var duration = totalDirtyData * rowSizeInBytes * timePerByte;
    
        var interval = duration / 100;
        var currentPercentage = 0;
    
        var progressInterval = setInterval(() => {
            currentPercentage++;
            progress.setCurrent(currentPercentage);
    
            if (currentPercentage >= 100) {
                clearInterval(progressInterval);
                if (onCompleted) onCompleted();  // 콜백 실행
            }
        }, interval);
    
        return progressInterval;
    }
    
    function getCurrentMonth() {
    
        var date = new Date();
        var year = date.getFullYear();              //yyyy
        var month = (1 + date.getMonth());          //M
        month = month >= 10 ? month : '0' + month;  //month 두자리로 저장
    
        return year + '' + month;
    
    }
    
    function searchData() {
    
        var change_Year_Month = self.mpPROMO_YEAR_MONTH.value();
        self.mpPROMO_YEAR_MONTH.value(change_Year_Month);
    
        dews.ui.loading.show({
            text: '조회중입니다.'
        });
        self.grid_ds.read();
    
    }
    
    function checkValidate(e) {
    
        var trgtGrdCd = self.gridMaster.getCellValue(self.gridMaster.select(), 'TRGT_GRD_CD');
        var ugrdGrdCd = self.gridMaster.getCellValue(self.gridMaster.select(), 'UGRD_GRD_CD');
        var cellData = e.cell.data;
    
        if (cellData && e.cell.field === 'TRGT_GRD_CD' && ugrdGrdCd && cellData >= ugrdGrdCd) {
            self.gridMaster.setCellValue(e.row.index, 'TRGT_GRD_CD', "");
            return dews.ui.snackbar.warning("대상등급이 승급등급보다 낮아야 합니다.");
        }
        if (cellData && e.cell.field === 'UGRD_GRD_CD' && trgtGrdCd && cellData <= trgtGrdCd) {
            self.gridMaster.setCellValue(e.row.index, 'UGRD_GRD_CD', "");
            return dews.ui.snackbar.warning("대상등급보다 승급등급이 높아야 합니다.");
    
        }
    
    }
    //엑셀업로드 그리드 -> 마스터그리드로 데이터 전달
    function transferExcelGridToMasterGrid() {
        isRowAdded = false;
        var importDataCount = self.importExcelGrid.dataItems().length;
        var rowNum = self.gridMaster.dataItems().length;
    
        for (var i = 0; i < importDataCount; i++) {
    
            self.gridMaster.addRow(rowNum);
            var idx = self.gridMaster.select();
            var pstnNm = self.importExcelGrid.getCellValue(i, 'PSTN_NM');
            var ledumCd = self.importExcelGrid.getCellValue(i, 'LEDU_CD');
    
            // TRGT_GRD_CD 처리 (기본값 'K1' 설정, 소문자일 경우 대문자처리)
            var trgtGrdCd = self.importExcelGrid.getCellValue(i, 'TRGT_GRD_CD');
            trgtGrdCd = (trgtGrdCd == null || trgtGrdCd == undefined) ? 'K1' : trgtGrdCd.toUpperCase();
    
            // UGRD_GRD_CD 처리 (기본값 'K2' 설정)
            var ugrdGrdCd = self.importExcelGrid.getCellValue(i, 'UGRD_GRD_CD');
            ugrdGrdCd = (ugrdGrdCd == null || ugrdGrdCd == undefined) ? 'K2' : ugrdGrdCd.toUpperCase();
    
            //BWRK_SGRAD_CD 처리
            var bwrkSgradCd = self.importExcelGrid.getCellValue(i, 'BWRK_SGRAD_CD');
            //BWRK_MY_CALC_STD_DT 처리
            var bwrkMyCalcStdDt = self.importExcelGrid.getCellValue(i, 'BWRK_MY_CALC_STD_DT');
            bwrkMyCalcStdDt = (bwrkMyCalcStdDt == null || bwrkMyCalcStdDt == undefined || bwrkMyCalcStdDt == "") ? self.mpPROMO_YEAR_MONTH.value() + "01" : bwrkMyCalcStdDt;
    
            self.gridMaster.setCellValue(idx, 'STD_YM', self.importExcelGrid.getCellValue(i, 'STD_YM'), false); // 기준년월에 "승급년월" 저장
            self.gridMaster.setCellValue(idx, 'PSTN_NM', self.importExcelGrid.getCellValue(i, 'PSTN_NM'), false); //직급명
            self.gridMaster.setCellValue(idx, 'PSTN_CD', pstnNmMap[pstnNm], false);
            self.gridMaster.setCellValue(idx, 'TRGT_GRD_CD', trgtGrdCd, false); // 대상등급
            self.gridMaster.setCellValue(idx, 'UGRD_GRD_CD', ugrdGrdCd, false); // 승급등급
    
            self.gridMaster.setCellValue(idx, 'AGGR_TERM_CNT', self.importExcelGrid.getCellValue(i, 'AGGR_TERM_CNT'), false); // 근무성적집계기간
            self.gridMaster.setCellValue(idx, 'BWRK_SGRAD_CD', bwrkSgradCd, false); // 근무성적
            self.gridMaster.setCellValue(idx, 'BWRK_SGRAD_NM', bwrkMap[bwrkSgradCd], false); // 근무성적
            self.gridMaster.setCellValue(idx, 'LEDU_NM', self.importExcelGrid.getCellValue(i, 'LEDU_NM'), false); // 학력
    
            self.gridMaster.setCellValue(idx, 'LEDU_CD', ledumCd, false); // 학력코드
            self.gridMaster.setCellValue(idx, 'BWRK_MY_CALC_STD_DT', bwrkMyCalcStdDt, false); // 산정기준일
            self.gridMaster.setCellValue(idx, 'RMK_NM', self.importExcelGrid.getCellValue(i, 'RMK_NM'), false); // 비고
            self.gridMaster.setCellValue(idx, 'bizarea_cd', self.bizarea_cd.value(), false);
    
            var importExcelGrid = self.importExcelGrid;
            //최소근무월수 생성
            var minBwrkMy = updateMinimumWorkMonths(importExcelGrid, i);
            //console.log("minBwrkMy" + minBwrkMy);
            self.gridMaster.setCellValue(idx, 'MIN_BWRK_MY', minBwrkMy, false);
    
            // 'STD_YM', 'bizarea_cd', 'PSTN_CD', 'TRGT_GRD_CD'를 결합하여 'COMBINED_KEY' 생성
            var combinedKey = self.importExcelGrid.getCellValue(i, 'STD_YM') + '-' + self.bizarea_cd.value() + '-' + pstnNmMap[pstnNm] + '-' + trgtGrdCd + '-' + ugrdGrdCd + '-' + minBwrkMy;
            self.gridMaster.setCellValue(idx, 'COMBINED_KEY', combinedKey, false);// 결합키 
    
    
        }
    }
    
    function handleDuplicateData() {
    
        var allData = self.gridMaster.dataItems();
        //self.mpPROMO_YEAR_MONTH.value(self.gridMaster.dataItems()[0].STD_YM);
        var groupedDataMap = new Map();
        var seqCounter = 1; // SEQ 시작
    
        // 데이터 그룹화 및 SEQ 할당
        for (var i = 0; i < allData.length; i++) {
    
            var rowData = allData[i];
            var combinedKey = rowData.COMBINED_KEY;
    
            if (!groupedDataMap.has(combinedKey)) {
                groupedDataMap.set(combinedKey, []); //중복된 최상위데이터 기준으로 빈 배열 생성
            }
    
            rowData.SEQ = seqCounter++; // SEQ 할당하고 증가
            groupedDataMap.get(combinedKey).push(rowData);
    
        }
    
        // 중복 데이터에 대해 CSS 및 체크박스 적용
        for (var group of groupedDataMap.values()) {
    
            if (group.length > 1) { // 중복 데이터가 있는 경우만 처리
                for (var k = 1; k < group.length; k++) { // 최상위 중복 데이터는 제외
                    var rowIndex = group[k].SEQ - 1; // 0-based index
                    var idx = self.gridMaster.getDataIndexFromItemIndex(rowIndex);
                    self.gridMaster.setCheck(idx, true, true); //체크박스 설정
                    self.gridMaster.setRowStyle(idx, { background: '#FFE4E1' }); //분홍색
                }
            }
    
        }
        self.gridMaster.sort([{ field: 'COMBINED_KEY', dir: 'asc' }]); //결합키 기준으로 오름차순 (그룹화 효과)
        // 정렬 후 첫 번째 그룹의 두 번째 데이터를 선택
        var firstGroup = groupedDataMap.values().next().value;
        if (firstGroup.length > 1) {
            self.mpPROMO_YEAR_MONTH.value(firstGroup[1].STD_YM);
        }
    
    }
    
    function processLargeData(result, errMsg) {
    
        dews.ui.snackbar.info("1000건 이상의 데이터 입니다. 처리에 시간이 소요될 수 있습니다.");
        processImportData(result, errMsg);
        saveExcelData(result);
    
    }
    
    function processRegularData(result, errMsg) {
    
        self.gridMaster.clearRows();
        transferExcelGridToMasterGrid(); //importExcelGrid -> gridMaster 데이터전달
        handleDuplicateData(); //중복데이터 그룹화, 정렬하여 css 적용 
        checkErrors(result, errMsg);
    
    }
    
    
    function processImportData(result, errMsg) {
    
        if (result && result.totalCount === result.success.count) {
            for (let i = 0; i < result.success.count; i++) {
                self.importExcelGrid.setRowState(i, "created");
            }
            dews.ui.snackbar.info(`${result.totalCount}건 데이터를 불러왔습니다.`);
        } else {
            if (errMsg.length > 0) {
                dews.error(errMsg[0]);
            }
            dews.ui.loading.hide();
        }
    
    }
    
    function checkErrors(result, errMsg) {
    
        const checkedIndices = self.gridMaster.getCheckedIndex();
        if (checkedIndices.length > 0) {
            dews.ui.snackbar.info("중복된 데이터 삭제바랍니다.");
            //self.gridMaster.select(checkedIndices[0], 'STD_YM');
        }
    
    }
    
    function saveExcelData(result) {
    
    
        for (var i = 0; i < self.importExcelGrid.dataItems().length; i++) {
            var importGrid = self.importExcelGrid;
            var minBwrkMy = updateMinimumWorkMonths(importGrid, i);
            self.importExcelGrid.setCellValue(i, 'MIN_BWRK_MY', minBwrkMy, false);
        }
        dews.ui.loading.hide();
        var isProgressBarCompleted = false;
        var isApiDone = false;
    
        // 두 프로세스 모두 완료되었을 때 스낵바를 표시하는 함수
        function checkAndShowSnackbar() {
            if (isProgressBarCompleted && isApiDone) {
                dews.ui.snackbar.ok('자료가 정상적으로 저장되었습니다.');
                //self.gridMaster.select(checkedIndices[0], 'STD_YM');
                self.mpPROMO_YEAR_MONTH.value(self.importExcelGrid.dataItems()[0].STD_YM);
                searchData();
            }
        }
    
        // startProgress 함수를 호출하고 프로그레스바가 완료될 때의 콜백을 정의
        var progressIntervalReference = startProgress(result.totalCount, function () {
            isProgressBarCompleted = true;
            isApiDone = true;
            checkAndShowSnackbar();
        });
    
        // API 호출
        dews.api.post(
            dews.url.getApiUrl('HR', 'HRPamprg00100_X10005Service', 'uploadExcel_HR_URGDBASETBL_INFO_X10005MST'),
            {
                async: true,
                data: {
                    uploadData: JSON.stringify(self.importExcelGrid.dataItems()),
                    bizarea_cd: self.bizarea_cd.value()
                }
            }
        ).done(function (data) {
            clearInterval(progressIntervalReference);  // 프로그레스 인터벌을 중지
            dews.ui.progress("progress6").setCurrent(100);  // 프로그레스바를 100%로 설정
            isProgressBarCompleted = true;
            isApiDone = true;  // API 완료 상태를 true로 설정
            checkAndShowSnackbar();  // 스낵바 표시 조건 확인 및 표시
    
    
    
        }).fail(function (xhr, status, error) {
            clearInterval(progressIntervalReference);  // 에러 발생 시 프로그레스 인터벌 중지
            dews.ui.snackbar.warning('엑셀업로드 실패. 다시 업로드해주세요');
        });
    }
    
    
    function importExcel(e) {
    
        var errMsg = [];
        var stdYmMaxLength = 6;
        var pstnCdMaxLength = 6;
        var grdCdMaxLength = 10;
        var titleDepth = 1;
    
        // 데이터 소스 초기화
        self.importExcel_ds.data([]);
    
        // 엑셀 업로드 로딩바
        dews.ui.loading.show({ text: '엑셀 업로드 진행 중입니다.' });
        setTimeout(function () {
            // 로딩바 숨김 처리
            dews.ui.loading.hide();
            // 데이터 소스 바인딩
            self.importExcelGrid.importExcel({
    
                fileDialog: true,
                titleDepth: titleDepth,
                mapping: {
                    "STD_YM": "기준년월",
                    "PSTN_NM": "직급명",
                    "TRGT_GRD_CD": "대상등급",
                    "UGRD_GRD_CD": "승급등급",
                    "AGGR_TERM_CNT": "근무성적집계기간",
                    "BWRK_SGRAD_NM": "근무성적",
                    "LEDU_NM": "학력",
                    "BWRK_MY_CALC_STD_DT": "산정기준일",
                    "RMK_NM": "비고",
                },
                validator: row => {
    
                    var msg = '';
    
                    //기본키 누락시 업로드 실패
                    if (!row.STD_YM || row.STD_YM.length > stdYmMaxLength) {
                        msg = dews.string.format("기준년월이 올바르지 않습니다.\n확인 후 업로드 하십시오.({0})", row.STD_YM);
                        console.error(msg); //콘솔에 값누락 확인 
                        return false;
                    } else if (!row.PSTN_NM || row.PSTN_NM.length > pstnCdMaxLength) {
                        msg = dews.string.format("직급명이 올바르지 않습니다.\n확인 후 업로드 하십시오.({0}/{1})", row.STD_YM, row.PSTN_NM);
                        console.error(msg);
                        return false;
                    } else if (!row.TRGT_GRD_CD || row.TRGT_GRD_CD.length > grdCdMaxLength) {
                        msg = dews.string.format("대상등급이 올바르지 않습니다.\n확인 후 업로드 하십시오.({0}/{1}/{2})", row.STD_YM, row.PSTN_CD, row.TRGT_GRD_CD);
                        console.error(msg);
                        return false;
                    } else if (!row.UGRD_GRD_CD || row.UGRD_GRD_CD.length > grdCdMaxLength) {
                        msg = dews.string.format("승급등급이 올바르지 않습니다.\n확인 후 업로드 하십시오.({0}/{1}/{2}/{3})", row.STD_YM, row.PSTN_CD, row.TRGT_GRD_CD, row.UGRD_GRD_CD);
                        console.error(msg);
                    }
                    if (msg) {
                        errMsg.push(msg);
                        console.error(msg);
                        dews.ui.loading.hide(); // 에러 발생 시 로딩바 숨김
                        return false;
                    }
                    return true;
    
                },
                convertor: row => {
    
                    if (row.BIZAREA_NM == null || row.BIZAREA_NM == undefined) {
                        row.BIZAREA_CD = self.bizarea_cd.value(); // 현재 선택된 사업장으로 저장
                    }
                    row.PSTN_CD = pstnNmMap[row.PSTN_NM]; // '직급명'에 넣기(없으면 필수값 입력하라고 나옴)
                    row.LEDU_NM = row.LEDU_NM; //ds localdata 으로 매핑시도해봤지만 안됨
                    row.LEDU_CD = lecdMap[row.LEDU_NM];
                    row.BWRK_SGRAD_CD = bwrkMap[row.BWRK_SGRAD_NM];
    
                    return row;
    
    
                },
            }).done(result => {
    
                dews.ui.loading.hide();
    
                if (self.importExcelGrid.dataItems().length >= 100) {
                    dews.ui.loading.show("업로드가 시작됩니다.");
                }
                if (result.totalCount < 1000) {
    
                    processRegularData(result, errMsg);
                }
                else {
                    processLargeData(result, errMsg);
                }
    
            }).fail(error => {
    
                console.error(error);
                dews.ui.loading.hide();
                dews.ui.snackbar.warning("엑셀 업로드 실패했습니다. 파일을 확인해주세요.");
    
            }).always(() => {
    
                e.target.value = "";
    
            });
        }, 1000); // 1초 대기
    
    }
    
    
    
    function OpenDialogYm() {
        isRowAdded = false;
        var dialog = dews.ui.dialog("PAMPRG00100_YM", {
            url: "/view/HR/PAMPRG00100_YM",
            title: '년월조회',
            initData: { bizarea_cd: self.bizarea_cd.value() },
            size: "small",
            height: 420,
            buttons: 'applyAndClose',
            ok: function (data) {
                isRowAdded = false;
                console.log("data.STD_YM" + data.STD_YM);
                self.mpPROMO_YEAR_MONTH.value(data.STD_YM);
                dews.ui.mainbuttons.search.click();
                isDataBinding = false; // 데이터 바인딩 완료
            }
        });
        dialog.open();
    
    }
    
    function OpenDialogCopy() {
        isRowAdded = false;
        var dialog = dews.ui.dialog("PAMPRG00100_COPY", {
            url: "/view/HR/PAMPRG00100_COPY",
            title: '종전복사',
            initData: { mpPROMO_YEAR_MONTH: self.mpPROMO_YEAR_MONTH.value(), bizarea_cd: self.bizarea_cd.value() },
            size: "small",
            height: 390,
            buttons: 'applyAndClose',
            ok: function (data) {
                isRowAdded = false;
                console.log("data" + data);
                self.mpPROMO_YEAR_MONTH.value(data); //대상년월 전달받아 바인딩
                dews.ui.loading.show({
                    text: '조회중입니다.'
                });
                self.grid_ds.read(function () {
                    // 데이터 로딩이 완료된 후
                    dews.ui.loading.hide();
                });
                isRowAdded = false;
    
            }
        });
        dialog.open();
    
    }
    
    //데이터 insert, update 시에 3개의 유효성 검증을 치뤄야함
    //getDirty 각 중복검증 
    function isDuplicatedInDirty(dirty) {
        for (var i = 0; i < dirty.length; i++) {
            var strA = dirty[i].STD_YM + dirty[i].PSTN_NM + dirty[i].TRGT_GRD_CD + dirty[i].UGRD_GRD_CD + dirty[i].MIN_BWRK_MY;
            for (var j = i + 1; j < dirty.length; j++) {
                var strB = dirty[j].STD_YM + dirty[j].PSTN_NM + dirty[j].TRGT_GRD_CD + dirty[j].UGRD_GRD_CD + dirty[j].MIN_BWRK_MY;
                if (strA === strB) {
                    return true;
                }
            }
        }
        return false;
    }
    
    //getDirty added,updated 중복검증
    function isAddedUpdatedDuplicated(added, updated) {
        for (var i = 0; i < added.length; i++) {
            var strA = added[i].STD_YM + added[i].PSTN_NM + added[i].TRGT_GRD_CD + added[i].UGRD_GRD_CD + added[i].MIN_BWRK_MY;
            for (var j = 0; j < updated.length; j++) {
                var strB = updated[j].STD_YM + updated[j].PSTN_NM + updated[j].TRGT_GRD_CD + updated[j].UGRD_GRD_CD + updated[j].MIN_BWRK_MY;
                if (strA === strB) {
                    return true;
                }
            }
        }
        return false;
    }
    
    //getDirty 제외한 기존 데이터와 중복검증 
    function isDuplicatedInMaster(dirty) {
        var items = self.gridMaster.dataItems().slice();
    
        //getDirty 데이터 있는 행 제외
        for (var k = 0; k < dirty.length; k++) {
            var dirtyStr = dirty[k].STD_YM + dirty[k].PSTN_NM + dirty[k].TRGT_GRD_CD + dirty[k].UGRD_GRD_CD + dirty[k].MIN_BWRK_MY;
            var index = items.findIndex(item => item.STD_YM + item.PSTN_NM + item.TRGT_GRD_CD + item.UGRD_GRD_CD + item.MIN_BWRK_MY === dirtyStr);
            console.log("index" + index);
            if (index !== -1) {
                items.splice(index, 1);
            }
        }
    
        for (var i = 0; i < items.length; i++) {
            var compareStr = items[i].STD_YM + items[i].PSTN_NM + items[i].TRGT_GRD_CD + items[i].UGRD_GRD_CD + items[i].MIN_BWRK_MY;
            for (var j = 0; j < dirty.length; j++) {
                var dirtyStr = dirty[j].STD_YM + dirty[j].PSTN_NM + dirty[j].TRGT_GRD_CD + dirty[j].UGRD_GRD_CD + dirty[j].MIN_BWRK_MY;
                if (dirtyStr === compareStr) {
                    return true;
                }
            }
        }
        return false;
    }
    
    function updateMinimumWorkMonths(gridName, rowIndex) {
        var grid = self[gridName.id];
        console.log("grid" + grid);
    
        var position = grid.getCellValue(rowIndex, 'PSTN_CD') || "";
        var targetGrade = grid.getCellValue(rowIndex, 'TRGT_GRD_CD') || "";
        var upgradeGrade = grid.getCellValue(rowIndex, 'UGRD_GRD_CD') || "";
        var workGrade = grid.getCellValue(rowIndex, 'BWRK_SGRAD_CD') || ""; // 근무성적
        var education = grid.getCellValue(rowIndex, 'LEDU_CD') || "";
    
    
    
        // getMinimumWorkMonths 함수를 이용하여 최소 근무 월 수를 계산
        var minWorkMonths = getMinimumWorkMonths(position, targetGrade, upgradeGrade, education, workGrade);
    
        //학력과 근무성적 값이 입력되지 않았을 경우, 최소근무월수를 추가로 5개월씩 더함
        if (education === "") {
            minWorkMonths += 5;
        }
        if (workGrade === "") {
            minWorkMonths += 5;
        }
    
        return minWorkMonths;
        // // 계산된 최소 근무 월 수를 해당 셀에 설정
        // grid.setCellValue(rowIndex, 'MIN_BWRK_MY', minWorkMonths, false);
    }
    // 알파벳 순서 기반의 계산 함수
    function getAlphabetOrderValue(grade) {
        if (!grade) return 0;
        var firstCharValue = grade.charCodeAt(0) - 65;  // A = 0, B = 1, ...
        var secondCharValue = parseInt(grade[1], 10) || 0;
        return firstCharValue * 10 + secondCharValue;
    }
    
    function getMinimumWorkMonths(position, targetGrade, upgradeGrade, education, workGrade) {
        var baseMonthsForPosition = {
            '11': 60,
            '13': 55,
            '14': 50,
            '16': 45,
            '17': 40,
            '18': 35,
            '19': 30,
            '20': 25,
            '21': 20
        };
    
        var gradeModifier = {
            'K1': 5,
            'K2': 4,
            'K3': 3,
            'K4': 2,
            'K5': 1
        };
    
        var educationModifier = {
            '1': 5,
            '2': 4,
            '3': 3,
            '4': -1,
            '5': -2,
            '6': -3
        };
    
        // gradeModifier에서 값을 가져오고, 없으면 알파벳 순서로 값을 가져옴
        const getGradeValue = (grade) => gradeModifier[grade] || -getAlphabetOrderValue(grade);
    
    
        // targetGrade와 upgradeGrade 간의 차이 계산
        var gradeDifference = (getGradeValue[upgradeGrade] || 0) - (getGradeValue[targetGrade] || 0);
    
        // 차이가 클수록 근무월수가 늘어나도록 반영
        var gradeDifferenceMonths = -gradeDifference * 5;
    
    
        return Number(baseMonthsForPosition[position] || 0)
            + Number(gradeDifferenceMonths || 0)
            + Number(educationModifier[education] || 0)
            + Number(workGrade || 0);
    }
    
    
    
    
    
    self.grid_ds = dews.ui.dataSource('grid_ds', {
      grid: true,
      paging: 'scroll',
      pagingCount: 500,
      transport: {
        read: {
          url: dews.url.getApiUrl('HR', 'HRPamprg00100_X10005Service', 'list_HR_URGDBASETBL_INFO_X10005MST'),
          data: function () {
            return {
              mpPROMO_YEAR_MONTH: self.mpPROMO_YEAR_MONTH.value(),
              bizarea_cd: self.bizarea_cd.value()
            };
          }
        }
      },
      schema: {
        model: {
          fields: [
            { field: 'STD_YM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'PSTN_NM', editable: false, dataType: 'string' }, 
            { field: 'ORIG_PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'TRGT_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'ORIG_TRGT_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'UGRD_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'ORIG_UGRD_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'MIN_BWRK_MY', editable: false, dataType: 'number' }, 
            { field: 'ORIG_MIN_BWRK_MY', editable: false, dataType: 'number' }, 
            { field: 'AGGR_TERM_CNT', editable: false, dataType: 'number' }, 
            { field: 'BWRK_SGRAD_CD', editable: false, dataType: 'string' }, 
            { field: 'LEDU_CD', editable: false, dataType: 'string' }, 
            { field: 'BWRK_MY_CALC_STD_DT', editable: false, dataType: 'string' }, 
            { field: 'BIZAREA_CD', editable: false, dataType: 'string' }, 
            { field: 'LEDU_NM', editable: false, dataType: 'string' }, 
            { field: 'RMK_NM', editable: false, dataType: 'string' }, 
            { field: 'BIZAREA_NM', editable: false, dataType: 'string' }, 
            { field: 'COMBINED_KEY', editable: false, dataType: 'string' }, 
            { field: 'SEQ', editable: false, dataType: 'string' }, 
            { field: 'BWRK_SGRAD_NM', editable: false, dataType: 'string' }
          ]
    
        }
      }
    });
    self.pipeDataSource1 = dews.ui.dataSource('pipeDataSource1', {
      schema: {
        model: {
          fields: [
            { field: 'BWRK_SGRAD_CD', editable: false, type: 'string' }, 
            { field: 'BWRK_SGRAD_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [ {"BWRK_SGRAD_CD":10,"BWRK_SGRAD_NM":"S"},{"BWRK_SGRAD_CD":9,"BWRK_SGRAD_NM":"A"},{"BWRK_SGRAD_CD":8,"BWRK_SGRAD_NM":"B"},{"BWRK_SGRAD_CD":7,"BWRK_SGRAD_NM":"C"},{"BWRK_SGRAD_CD":6,"BWRK_SGRAD_NM":"D"}]
    });
    dews.api.get(dews.url.getApiUrl('CM', 'CommonCodeDtlService', 'common_ci_codeDtl_list'),{
      async: false,
      data: {
          end_dt: '',
          foreign_yn: '',
          field_cd_pipe: 'P00650|P00670',
          module_cd: 'HR',
          syscode_yn: '',
          keyword: '',
          base_yn: ''
      }
    }).done(function (data) {
      var ar_P00650 = new Array();
      var ar_P00670 = new Array();
    
      for (var i = 0; i < data.length; i++) {
        if (data[i].FIELD_CD == "P00650") { 
          ar_P00650.push(data[i]); 
    
        }
        else if (data[i].FIELD_CD == "P00670") { 
          ar_P00670.push(data[i]); 
    
        }
      }
      self.pipeDataSource2_P00650 = dews.ui.dataSource('pipeDataSource2_P00650',  { data: ar_P00650 });
      self.pipeDataSource2_P00670 = dews.ui.dataSource('pipeDataSource2_P00670',  { data: ar_P00670 });
      self.pipeDataSource2 = dews.ui.dataSource('pipeDataSource2', { data: data });
      
    });
    self.bizareaCd_ds = dews.ui.dataSource('bizareaCd_ds', {
      schema: {
        model: {
          fields: [
            { field: 'BIZAREA_CD', editable: false, type: 'string' }, 
            { field: 'BIZAREA_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{"BIZAREA_CD": "1000","BIZAREA_NM":"본점"},{"BIZAREA_CD": "2000","BIZAREA_NM":"부산점"},{"BIZAREA_CD": "3000","BIZAREA_NM":"여수점"},{"BIZAREA_CD": "522","BIZAREA_NM":"평화이즈"}]
    
    });
    self.trgt_grd_cd_ds = dews.ui.dataSource('trgt_grd_cd_ds', {
      schema: {
        model: {
          fields: [
            { field: 'TRGT_GRD_CD', editable: false, type: 'string' }, 
            { field: 'TRGT_GRD_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{"TRGT_GRD_CD": "K1","TRGT_GRD_NM":"K1"},{"TRGT_GRD_CD": "K2","TRGT_GRD_NM":"K2"},{"TRGT_GRD_CD": "K3","TRGT_GRD_NM":"K3"},{"TRGT_GRD_CD": "K4","TRGT_GRD_NM":"K4"},{"TRGT_GRD_CD": "K5","TRGT_GRD_NM":"K5"}]
    
    });
    self.ugrd_grd_cd_ds = dews.ui.dataSource('ugrd_grd_cd_ds', {
      schema: {
        model: {
          fields: [
            { field: 'UGRD_GRD_CD', editable: false, type: 'string' }, 
            { field: 'UGRD_GRD_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{"UGRD_GRD_CD": "K5","UGRD_GRD_NM":"K5"},{"UGRD_GRD_CD": "K4","UGRD_GRD_NM":"K4"},{"UGRD_GRD_CD": "K3","UGRD_GRD_NM":"K3"},{"UGRD_GRD_CD": "K2","UGRD_GRD_NM":"K2"},{"UGRD_GRD_CD": "K1","UGRD_GRD_NM":"K1"}]
    });
    self.importExcel_ds = dews.ui.dataSource('importExcel_ds', {
      grid: true,
      schema: {
        model: {
          fields: [
            { field: 'STD_YM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_NM', editable: false, dataType: 'string' }, 
            { field: 'TRGT_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'UGRD_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'MIN_BWRK_MY', editable: false, dataType: 'number' }, 
            { field: 'AGGR_TERM_CNT', editable: false, dataType: 'number' }, 
            { field: 'BWRK_SGRAD_CD', editable: false, dataType: 'string' }, 
            { field: 'LEDU_CD', editable: false, dataType: 'string' }, 
            { field: 'BWRK_MY_CALC_STD_DT', editable: false, dataType: 'string' }, 
            { field: 'RMK_NM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_CD', editable: false, dataType: 'string' }, 
            { field: 'LEDU_NM', editable: false, dataType: 'string' }
          ]
    
        }
      },
      data: [ {"PSTN_CD":"11","PSTN_NM":"대표이사"},{"PSTN_CD":"13","PSTN_NM":"감사"},{"PSTN_CD":"14","PSTN_NM":"전무이사"},{"PSTN_CD":"16","PSTN_NM":"이사"},{"PSTN_CD":"17","PSTN_NM":"부장"},{"PSTN_CD":"18","PSTN_NM":"차장"},{"PSTN_CD":"19","PSTN_NM":"과장"},{"PSTN_CD":"20","PSTN_NM":"대리"},{"PSTN_CD":"21","PSTN_NM":"사원"}]
    [{"LECD_CD":"1","LECD_NM":"초등졸"},{"LECD_CD":"22","LECD_NM":"중졸"},{"LECD_CD":"3","LECD_NM":"고졸"},{"LECD_CD":"4","LECD_NM":"전문대졸"},{"LECD_CD":"5","LECD_NM":"대졸"},{"LECD_CD":"6","LECD_NM":"대학원졸"}]
    });
    self.forExcelDataSource = dews.ui.dataSource('forExcelDataSource', {
      grid: true,
      schema: {
        model: {
          fields: [
            { field: 'STD_YM', editable: false, dataType: 'string' }, 
            { field: 'PSTN_NM', editable: false, dataType: 'string' }, 
            { field: 'TRGT_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'UGRD_GRD_CD', editable: false, dataType: 'string' }, 
            { field: 'MIN_BWRK_MY', editable: false, dataType: 'number' }, 
            { field: 'AGGR_TERM_CNT', editable: false, dataType: 'number' }, 
            { field: 'BWRK_SGRAD_CD', editable: false, dataType: 'string' }, 
            { field: 'LEDU_CD', editable: false, dataType: 'string' }, 
            { field: 'BWRK_MY_CALC_STD_DT', editable: false, dataType: 'string' }, 
            { field: 'RMK_NM', editable: false, dataType: 'string' }
          ]
    
        }
      },
      data: []
    });
    self.pstn_cd_ds = dews.ui.dataSource('pstn_cd_ds', {
      schema: {
        model: {
          fields: [
            { field: 'PSTN_CD', editable: false, type: 'string' }, 
            { field: 'PSTN_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [ {"PSTN_CD":"11","PSTN_NM":"대표이사"},{"PSTN_CD":"13","PSTN_NM":"감사"},{"PSTN_CD":"14","PSTN_NM":"전무이사"},{"PSTN_CD":"16","PSTN_NM":"이사"},{"PSTN_CD":"17","PSTN_NM":"부장"},{"PSTN_CD":"18","PSTN_NM":"차장"},{"PSTN_CD":"19","PSTN_NM":"과장"},{"PSTN_CD":"20","PSTN_NM":"대리"},{"PSTN_CD":"21","PSTN_NM":"사원"}]
    });
    self.ledu_cd_ds = dews.ui.dataSource('ledu_cd_ds', {
      schema: {
        model: {
          fields: [
            { field: 'LEDU_CD', editable: false, type: 'string' }, 
            { field: 'LEDU_NM', editable: false, type: 'string' }
          ]
    
        }
      },
      data: [{"LECD_CD":"1","LECD_NM":"초등졸"},{"LECD_CD":"22","LECD_NM":"중졸"},{"LECD_CD":"3","LECD_NM":"고졸"},{"LECD_CD":"4","LECD_NM":"전문대졸"},{"LECD_CD":"5","LECD_NM":"대졸"},{"LECD_CD":"6","LECD_NM":"대학원졸"}]
    });
    
    
    dews.ui.mainbuttons.localize.disable(true);
    dews.ui.mainbuttons.add.click(/*71614df6-9a67-4b0a-8f1b-7fb106ef6a8f*/ function () {
        isRowAdded = true; // 플래그 설정
        self.gridMaster.addRow(0);
        var idx = self.gridMaster.select();
    
        self.gridMaster.setCellValue(idx, 'STD_YM', self.mpPROMO_YEAR_MONTH.value(), false);
        self.gridMaster.setCellValue(idx, 'bizarea_cd', self.bizarea_cd.value(), false);
        self.gridMaster.setCellValue(idx, 'BIZAREA_NM', self.bizarea_cd.text(), false);
        self.gridMaster.setCellValue(idx, 'TRGT_GRD_CD', 'K1', false);
        self.gridMaster.setCellValue(idx, 'UGRD_GRD_CD', 'K2', false);
        self.gridMaster.setCellValue(idx, 'BWRK_MY_CALC_STD_DT', self.mpPROMO_YEAR_MONTH.value() + "01", false);
    
    });
    dews.ui.mainbuttons.search.click(/*37fe89ce-9f9d-444b-a3a3-dfe45a8e42e2*/ function () {
    
        self.gridMaster.setOptions({
            rowNo: true
        })
    
        if (self.grid_ds.getDirtyDataCount() > 0) {
            dews.confirm('저장되지 않은 데이터가 있습니다.\n그래도 조회 하시겠습니까?', "question").yes(function () {
                searchData();
            }).no(function () {
            });
        } else {
            searchData();
        }
    
    });
    dews.ui.mainbuttons.delete.click(/*281e85d0-3c8c-47ce-aa4b-175197739eb1*/ function (e) {
    
    
        try {
            // 체크된 행 인덱스를 가진 배열
            var checkArray = self.gridMaster.getCheckedIndex();
            if (checkArray.length == 0) { // 체크된 행이 없다면
                dews.ui.snackbar.warning("체크된 행이 없습니다."); // 스낵바 경고 띄우기
                return;
            }
            dews.confirm("삭제하시겠습니까?", "question").yes(function () {
    
                //중복데이터css 삭제 -> 삭제 후에도 index 남아있어서 남아있어야하는 row도 css 적용되어 있음
                for (var i = 0; i < self.gridMaster.dataItems().length; i++) {
                    var dataIndex = self.gridMaster.getDataIndexFromItemIndex(i);
                    self.gridMaster.resetRowStyle(dataIndex);
                }
                self.gridMaster.removeRow(checkArray); // 체크된 행 모두 삭제하기
                dews.ui.snackbar.info("저장을 눌러 삭제를 완료하세요.");
    
            });
        } catch (error) {
            console.error(error);
            dews.error(error);
        }
    
    });
    dews.ui.mainbuttons.save.click(/*de6735b5-68c0-4785-bc2d-308bb03c399d*/ function (e) {
        isRowAdded = false;
        self.gridMaster.commitCell();
        if (self.grid_ds.getDirtyDataCount() == 0) {
            dews.alert('변경된 데이터가 없습니다.');
            return false;
        }
    
        if (self.gridMaster.validate().result == false) {
            dews.alert('필수 값이 입력되지 않은 항목이 있습니다.');
            return false;
        }
        //getDirty끼리의 중복 검증 
        if (isAddedUpdatedDuplicated(self.grid_ds.getDirtyData().Added, self.grid_ds.getDirtyData().Updated)) {
            return dews.ui.snackbar.warning("이미 중복된 내용이 있습니다. 다시 입력해주세요");
        }
    
        //getDirty 제외한 기존에 있는 데이터 중복 확인
        if (self.grid_ds.getDirtyData().Added.length > 0) {
            if (isDuplicatedInDirty(self.grid_ds.getDirtyData().Added) || isDuplicatedInMaster(self.grid_ds.getDirtyData().Added)) {
                return dews.ui.snackbar.warning("이미 중복된 내용이 있습니다. 다시 입력해주세요");
            }
        }
    
        if (self.grid_ds.getDirtyData().Updated.length > 0) {
            if (isDuplicatedInDirty(self.grid_ds.getDirtyData().Updated) || isDuplicatedInMaster(self.grid_ds.getDirtyData().Updated)) {
                return dews.ui.snackbar.warning("이미 중복된 내용이 있습니다. 다시 입력해주세요");
            }
        }
    
        dews.api.post(
            dews.url.getApiUrl('HR', 'HRPamprg00100_X10005Service', 'save_HR_URGDBASETBL_INFO_X10005MST'), {
            async: false,
            data: {
                grid_ds: JSON.stringify(self.grid_ds.getDirtyData())
            }
        }
        ).done(function (data) {
            dews.ui.snackbar.ok('자료가 정상적으로 저장되었습니다.');
            isRowAdded = false;
            dews.ui.loading.show({
                text: '조회중입니다.'
            });
    
            // 1초 후에 로딩 메시지를 숨기고 데이터 조회
            setTimeout(function () {
                dews.ui.loading.hide();
                self.grid_ds.read();
            }, 1000);
        }).fail(function (xhr, status, error) {
            dews.ui.snackbar.error("이미 등록된 승급기준등록 이력이 있습니다. 재조회 후 처리하십시오.");
        });
    
    });
    self.$copybtnApply.on('click', /*df183ba1-b663-4f91-b5c4-39905db4b87c*/ function (e) {
    
        OpenDialogCopy();
    
    });
    
    /**
     * @Control : Button
     * @Event : click
     * @Control-ID : downloadBtnTempvar
     * @Warning : 주석라인 수정시 스크립트 저장에 문제가 발생할 수 있습니다.
     */
    self.$downloadBtnTemplet.on('click', function (e) {
    
        try {
            // 사업장번호 선택되어 있어야 함
            if (self.mpPROMO_YEAR_MONTH.value() == '' || self.bizarea_cd.value() == '') {
                dews.ui.snackbar.warning("누락된 필수값이 있습니다.");
                return false;
            }
            // 데이터가 없을 시 한 줄 추가(양식)
            if (self.excelFormGrid.dataItems().length === 0) {
                self.excelFormGrid.addRow();
            }
            // 파일 이름
            var downloadFileName = dews.string.format("승급기준표등록__{0}.xlsx", dews.date.format(new Date(), "yyyyMMdd_HHmmss"));
            // Excel 서식 다운로드
            var exportToExcelOptions = {
                fileName: downloadFileName,
                exportGrids: [
                    { grid: self.excelFormGrid, sheetName: "UPLOAD" }
                ]
            };
            self.excelFormGrid.saveAsExcel(exportToExcelOptions);
            dews.ui.snackbar.ok("양식 다운로드 완료되었습니다.");
        } catch (error) {
            dews.error(error);
            console.log(error);
        }
    
    });
    self.$downloadBtnTemplet.on('click', /*481962ba-2461-4e07-81cc-b0b656c4f1aa*/ function (e) {
    
        try {
            // 사업장번호 선택되어 있어야 함
            if (self.mpPROMO_YEAR_MONTH.value() == '' || self.bizarea_cd.value() == '') {
                dews.ui.snackbar.warning("누락된 필수값이 있습니다.");
                return false;
            }
            // 데이터가 없을 시 한 줄 추가(양식)
            if (self.excelFormGrid.dataItems().length === 0) {
                self.excelFormGrid.addRow();
            }
            // 파일 이름
            var downloadFileName = dews.string.format("승급기준표등록__{0}.xlsx", dews.date.format(new Date(), "yyyyMMdd_HHmmss"));
            // Excel 서식 다운로드
            var exportToExcelOptions = {
                fileName: downloadFileName,
                exportGrids: [
                    { grid: self.excelFormGrid, sheetName: "UPLOAD" }
                ]
            };
            self.excelFormGrid.saveAsExcel(exportToExcelOptions);
            dews.ui.snackbar.ok("양식 다운로드 완료되었습니다.");
        } catch (error) {
            dews.error(error);
            console.log(error);
        }
    
    });
    self.$downloadBtnData.on('click', /*59f767f2-0727-4c9b-87c6-a0f0715be7cc*/ function (e) {
    
        if (self.mpPROMO_YEAR_MONTH.value() == '' || self.bizarea_cd.value() == '') {
            dews.ui.snackbar.warning("누락된 필수값이 있습니다.");
            return false;
        }
        // 파일 이름
        var downloadFileName = dews.string.format("승급기준표등록__{0}.xlsx", dews.date.format(new Date(), "yyyyMMdd_HHmmss"));
        // Excel 서식 다운로드
        var exportToExcelOptions = {
            fileName: downloadFileName,
            exportGrids: [
                { grid: self.grid_ds.STD_YM, sheetName: "UPLOAD" },
            ],
        };//saveAsExcel: 그리드의 내용을 엑셀로 저장
        self.gridMaster.saveAsExcel(exportToExcelOptions);
    
    });
    self.$uploadBtnApply.on('click', /*9ed4bb85-ff33-478d-ad7d-c8670429122e*/ function (e) {
    
        self.gridMaster.setOptions({
            rowNo: false
        })
    
        if (self.mpPROMO_YEAR_MONTH.value() == '' || self.bizarea_cd.value() == '') {
            dews.ui.snackbar.warning("누락된 필수값이 있습니다.");
            return false;
        }
        try {
            importExcel(e);
        }
        catch (error) {
            dews.error(error);
            console.error(error);
            dews.ui.loading.hide(); // 에러 발생 시 로딩바 숨김
        }
    
    });
    self.mpPROMO_YEAR_MONTH.on('change', /*9cd054b6-b7e2-4b3e-b457-5bc434526e95*/ function (e) {
    
        if (self.conditionpanel.validate({ tooltip: true, message: '필수 항목을 입력해 주십시요.' })) {
            if (self.grid_ds.getDirtyDataCount() > 0) {
                dews.confirm('저장되지 않은 데이터가 있습니다.\n그래도 조회 하시겠습니까?', "question").yes(function () {
                    searchData();
                }).no(function () {
                });
            } else {
                searchData();
            }
        } else {
            dews.ui.snackbar.warning("누락된 필수값이 있습니다.");
        }
    
    });
    self.$aply_ym_btn.on('click', /*f375351e-f2cd-42c0-a2e3-e88865930234*/ function (e) {
    
        OpenDialogYm();
    
    });
    self.bizarea_cd.setDataSource(self.bizareaCd_ds);
    self.bizarea_cd.on('change', /*9d0c5005-009c-4935-bfac-11f9df587d44*/ function (e) {
    
        self.bizareaCd_ds.read();
    
    });
    dews.ui.grid(self.$gridMaster, {
      dataSource: self.grid_ds,
      editable: true,
      rowNo: false,
      selectable: true,
      sortable: false,
      noData: true,
      noDataMessage: '데이터가 없습니다',
      copyMode: 'cell',
      movable: true,
      columns: [
        {
          field: 'STD_YM',
          title: '기준년월',
          width: 60,
          attributes: { class: 'required' },
          formats: {
            type: 'month',
            format: 'yyyy-MM'
          },
          editor: {
            type: 'month',
            format: 'yyyy-MM'
          }
        },
        {
          field: 'PSTN_NM',
          title: '직급명',
          width: 90,
          attributes: { class: 'required' },
          editor: {
            type: 'codepicker',
            helpCode: 'H_MA_CODEDTL_S',
            codeField: 'SYSDEF_CD',
            textField: 'SYSDEF_NM',
            gridCodeField: 'PSTN_CD',
            gridTextField: 'PSTN_NM',
            helpTitle: '직급명 도움창',
            helpSize: 'medium',
            helpParams: /*2b417dd0-d4a3-452a-935e-423b44d1a9ac*/ function() {
    return {
    company_cd : self.user.companyCode,
    module_cd : 'HR',
    field_cd : 'P00650'
    }
    }
    
          }
        },
        {
          field: 'TRGT_GRD_CD',
          title: '대상등급',
          width: 80,
          attributes: { class: 'required' },
          editor: {
            type: 'dropDown',
            dataSource: self.trgt_grd_cd_ds,
            dataValueField: 'TRGT_GRD_CD',
            dataTextField: 'TRGT_GRD_NM'
          }
        },
        {
          field: 'UGRD_GRD_CD',
          title: '승급등급',
          width: 80,
          attributes: { class: 'required' },
          editor: {
            type: 'dropDown',
            dataSource: self.ugrd_grd_cd_ds,
            dataValueField: 'UGRD_GRD_CD',
            dataTextField: 'UGRD_GRD_NM'
          }
        },
        {
          field: 'AGGR_TERM_CNT',
          title: '근무성적집계기간',
          width: 90,
          formats: {
            type: 'number'
          },
          editor: {
            type: 'number',
            min: 0,
            max: 99999
          }
        },
        {
          field: 'BWRK_SGRAD_CD',
          title: '근무성적',
          width: 60,
          formats: {
            type: 'dataSource',
            dataSource: self.pipeDataSource1,
            dataValueField: 'BWRK_SGRAD_CD',
            dataTextField: 'BWRK_SGRAD_NM'
          },
          editor: {
            type: 'dropDown',
            dataSource: self.pipeDataSource1,
            dataValueField: 'BWRK_SGRAD_CD',
            dataTextField: 'BWRK_SGRAD_NM'
          }
        },
        {
          field: 'LEDU_NM',
          title: '학력',
          width: 90,
          editor: {
            type: 'codepicker',
            helpCode: 'H_MA_CODEDTL_S',
            codeField: 'SYSDEF_CD',
            textField: 'SYSDEF_NM',
            gridCodeField: 'LEDU_CD',
            gridTextField: 'LEDU_NM',
            helpTitle: '학력 도움창',
            helpSize: 'medium',
            helpParams: /*fbd13cb7-c7b9-4a25-a5a3-4bb76f76f9ef*/ function(e) {
    return {
    company_cd : self.user.companyCode,
    module_cd : "HR",
    field_cd : "P00670"
    }
    }
    
          }
        },
        {
          field: 'MIN_BWRK_MY',
          title: '최소근무월수',
          width: 60,
          attributes: { class: 'required' },
          formats: {
            type: 'number'
          },
          editor: { type: 'readonly' }
        },
        {
          field: 'BWRK_MY_CALC_STD_DT',
          title: '산정기준일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'RMK_NM',
          title: '비고',
          width: 90,
          editor: { type: 'string', maxLength: 0 }
        },
        {
          field: 'PSTN_CD',
          title: '직급코드',
          width: 80,
          visible: false
        },
        {
          field: 'ORIG_PSTN_CD',
          title: '수정이전 직급코드',
          width: 80,
          visible: false
        },
        {
          field: 'ORIG_TRGT_GRD_CD',
          title: '수정이전 등급코드',
          width: 80,
          visible: false
        },
        {
          field: 'ORIG_UGRD_GRD_CD',
          title: '수정이전 승급등급코드',
          width: 80,
          visible: false
        },
        {
          field: 'ORIG_MIN_BWRK_MY',
          title: '수정이전 최소근무월수',
          width: 60,
          visible: false
        },
        {
          field: 'LEDU_CD',
          title: '학력코드',
          width: 80,
          visible: false
        },
        {
          field: 'BIZAREA_CD',
          title: '사업장',
          width: 80,
          visible: false
        },
        {
          field: 'BIZAREA_NM',
          title: '사업장명',
          width: 90,
          align: 'left',
          visible: false
        },
        {
          field: 'COMBINED_KEY',
          title: '결합키',
          visible: false
        },
        {
          field: 'SEQ',
          title: '순번',
          visible: false
        },
        {
          field: 'BWRK_SGRAD_NM',
          title: '근무성적명',
          visible: false,
          formats: {
            type: 'dataSource',
            dataSource: self.pipeDataSource1,
            dataValueField: 'BWRK_SGRAD_CD',
            dataTextField: 'BWRK_SGRAD_NM'
          },
          editor: { type: 'string', maxLength: 3 }
        }
      ],
      fixed: {
        colCount: 0,
        rightColCount: 0
      },
      change: /*749ac85d-dcc3-45d3-b0d5-1b4ee3f17626*/ function (e) {
            if (isRowAdded) {
                var gridMaster = self.gridMaster;
                var minWorkMonths = updateMinimumWorkMonths(gridMaster, self.gridMaster.select());
                self.gridMaster.setCellValue(self.gridMaster.select(), 'MIN_BWRK_MY', minWorkMonths, false);
            }
        }
    ,
      dataBound: /*f2a9b86e-85a7-496c-9c13-48e694c672c9*/ function (e) {
            dews.ui.loading.hide();
        }
    ,
      validationCheck: /*4ce437c6-dafa-4120-a385-640d2b1d45b0*/ function (e) {
            checkValidate(e);
        }
    ,
      selected: /*06b5752c-b040-419d-895f-23f99fe4cb42*/ function (e) {
            if (!isDataBinding && isRowAdded) {
                var gridMaster = self.gridMaster;
                var minWorkMonths = updateMinimumWorkMonths(gridMaster, self.gridMaster.select());
                self.gridMaster.setCellValue(self.gridMaster.select(), 'MIN_BWRK_MY', minWorkMonths, false);
            }
        }
    
    });
    dews.ui.grid(self.$excelFormGrid, {
      dataSource: self.forExcelDataSource,
      sortable: false,
      autoBind: false,
      checkable: false,
      copyMode: 'cell',
      columns: [
        {
          field: 'STD_YM',
          title: '기준년월',
          width: 60
        },
        {
          field: 'PSTN_NM',
          title: '직급명',
          width: 90,
          align: 'left'
        },
        {
          field: 'TRGT_GRD_CD',
          title: '대상등급',
          width: 80
        },
        {
          field: 'UGRD_GRD_CD',
          title: '승급등급',
          width: 80
        },
        {
          field: 'MIN_BWRK_MY',
          title: '최소근무월수',
          width: 60,
          visible: false
        },
        {
          field: 'AGGR_TERM_CNT',
          title: '근무성적집계기간',
          width: 60
        },
        {
          field: 'BWRK_SGRAD_CD',
          title: '근무성적',
          width: 80
        },
        {
          field: 'LEDU_CD',
          title: '학력코드',
          visible: false
        },
        {
          field: 'LEDU_NM',
          title: '학력',
          width: 80,
          formats: {
            type: 'dataSource',
            dataSource: self.ledu_cd_ds,
            dataValueField: 'LEDU_CD',
            dataTextField: 'LEDU_NM'
          }
        },
        {
          field: 'BWRK_MY_CALC_STD_DT',
          title: '산정기준일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'RMK_NM',
          title: '비고',
          width: 90,
          align: 'left'
        },
        {
          field: 'BWRK_SGRAD_NM',
          title: '근무성적명',
          formats: {
            type: 'dataSource',
            dataSource: self.pipeDataSource1,
            dataValueField: 'BWRK_SGRAD_CD',
            dataTextField: 'BWRK_SGRAD_NM'
          }
        }
      ],
      fixed: {
        colCount: 0,
        rightColCount: 0
      }
    });
    dews.ui.grid(self.$importExcelGrid, {
      dataSource: self.importExcel_ds,
      sortable: false,
      autoBind: false,
      checkable: false,
      copyMode: 'cell',
      columns: [
        {
          field: 'STD_YM',
          title: '기준년월',
          width: 60
        },
        {
          field: 'PSTN_NM',
          title: '직급명',
          width: 90,
          align: 'left'
        },
        {
          field: 'TRGT_GRD_CD',
          title: '대상등급',
          width: 80
        },
        {
          field: 'UGRD_GRD_CD',
          title: '승급등급',
          width: 80
        },
        {
          field: 'MIN_BWRK_MY',
          title: '최소근무월수',
          width: 60,
          visible: false
        },
        {
          field: 'AGGR_TERM_CNT',
          title: '근무성적집계기간',
          width: 60
        },
        {
          field: 'BWRK_SGRAD_CD',
          title: '근무성적',
          width: 80
        },
        {
          field: 'LEDU_CD',
          title: '학력코드',
          width: 80,
          visible: false
        },
        {
          field: 'LEDU_NM',
          title: '학력',
          width: 80,
          formats: {
            type: 'dataSource',
            dataSource: self.ledu_cd_ds,
            dataValueField: 'LEDU_CD',
            dataTextField: 'LEDU_NM'
          }
        },
        {
          field: 'BWRK_MY_CALC_STD_DT',
          title: '산정기준일',
          width: 80,
          formats: {
            type: 'date',
            format: 'yyyy-MM-dd'
          },
          editor: {
            type: 'date',
            format: 'yyyy-MM-dd'
          }
        },
        {
          field: 'RMK_NM',
          title: '비고',
          width: 90,
          align: 'left'
        },
        {
          field: 'PSTN_CD',
          title: '직급코드',
          visible: false,
          formats: {
            type: 'dataSource',
            dataSource: self.pstn_cd_ds,
            dataValueField: 'PSTN_NM',
            dataTextField: 'PSTN_CD'
          }
        },
        {
          field: 'BWRK_SGRAD_NM',
          title: '근무성적명',
          formats: {
            type: 'dataSource',
            dataSource: self.pipeDataSource1,
            dataValueField: 'BWRK_SGRAD_CD',
            dataTextField: 'BWRK_SGRAD_NM'
          }
        }
      ],
      fixed: {
        colCount: 0,
        rightColCount: 0
      }
    });
    
    
    
    
    /*534ba9e1-a845-40e6-8d1e-d324d5bfa4cc*/ var isRowAdded = false;
    self.mpPROMO_YEAR_MONTH.value(getCurrentMonth());
    self.grid_ds.read();
    self.gridMaster.setOptions({
        rowNo: true
    })
    self.gridMaster.sort({ field: 'COMBINED_KEY', dir: 'asc' });
    
    
    
    

  
  });

</script>